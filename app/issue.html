<!--
  ~ Â© 2015-2016 Becki Authors. See the AUTHORS file found in the top-level
  ~ directory of this distribution.
  -->

<div data-bind-layout="heading" data-bind-breadcrumbs="breadcrumbs">
  <p data-bind-ngSwitch="!confirmationToRemove">
    <template data-bind-ngSwitchWhen="true">
      <template ngFor data-let-confirmation data-bind-ngForOf="confirmations">
        <span class="label" data-bind-style.background-color="confirmation.color" style="border: 1px solid #eeeeee">{{confirmation.type}} <a data-on-click="onConfirmationRemoveClick(confirmation, $event)" style="cursor: pointer; color: #333333; margin-left: 1em"><span class="pficon pficon-close"></span></a></span>
      </template>
    </template>
    <template data-bind-ngSwitchWhen="false">
      Do you really want to remove the confirmation?
      <button class="btn btn-danger" type="button" data-on-click="onConfirmationRemoveYesClick($event)">
        Yes
      </button>
      <button class="btn btn-default" type="button" data-on-click="onConfirmationRemoveNoClick($event)">
        No
      </button>
    </template>
  </p>
  <template data-bind-ngIf="related?.length">
    <div class="well">
      Following issues have been marked as related:
      <ul>
        <li template="ngFor let link of related" data-bind-ngSwitch="link.removing">
          <template data-bind-ngSwitchWhen="true">
            Do you really want to unmark this issue?
            <button class="btn btn-danger" type="button" data-on-click="onRelatedRemovingYesClick(link, $event)">Yes</button>
            <button class="btn btn-default" type="button" data-on-click="onRelatedRemovingNoClick(link, $event)">No</button>
          </template>
          <template data-bind-ngSwitchWhen="false">
            <a data-bind-routerLink="link.targetLink">{{link.model.answer.name}}</a>
            <template data-bind-ngIf="link.removeLink">
              <a class="text-danger" data-on-click="onRelatedRemoveClick(link, $event)" style="cursor: pointer">
                <span class="pficon pficon-close"></span>
              </a>
            </template>
          </template>
        </li>
      </ul>
    </div>
  </template>
  <div class="media" template="ngFor let item of items">
    <div class="media-left">
      <div class="btn-group-vertical">
        <button class="btn btn-default" type="button" data-on-click="onPlusClick(item.id, $event)">
          <span class="glyphicon glyphicon-thumbs-up"></span>
        </button>
        <div class="h2" style="margin: 6px 12px;text-align: center;">
          {{item.likes}}
        </div>
        <button class="btn btn-default" type="button" data-on-click="onMinusClick(item.id, $event)">
          <span class="glyphicon glyphicon-thumbs-down"></span>
        </button>
      </div>
    </div>
    <div class="media-body">
      <div class="panel panel-default">
        <div class="panel-body">
          <template data-bind-ngIf="item.editing">
            <form class="clearfix" data-on-submit="onItemEditingSubmit(item, $event)">
              <template data-bind-ngIf="item.hasOwnProperty('typeField')">
                <div class="form-group">
                  <label>
                    <span class="glyphicon glyphicon-list"></span>
                    Type
                  </label>
                  <select class="form-control" required data-bindon-ngModel="item.typeField">
                    <option value="">Select type...</option>
                    <option data-bind-value="type.id" template="ngFor let type of types">
                      {{type.type}}
                    </option>
                  </select>
                </div>
              </template>
              <template data-bind-ngIf="item.hasOwnProperty('titleField')">
                <div class="form-group">
                  <label>
                    <span class="glyphicon glyphicon-pencil"></span>
                    Title
                  </label>
                  <input class="form-control" required minlength="8" data-bindon-ngModel="item.titleField">
                </div>
              </template>
              <div class="form-group">
                <label>
                  <span class="glyphicon glyphicon-pencil"></span>
                  Body
                </label>
                <div data-bindon-fieldIssueBody="item.bodyField" data-bind-required="true">
                  <div class="spinner"></div>
                </div>
              </div>
              <template data-bind-ngIf="item.tagsEditable">
                <div class="form-group">
                  <label>
                    <span class="glyphicon glyphicon-tag"></span>
                    Tags
                  </label>
                  <div data-bindon-fieldIssueTags="item.tagsField">
                    <div class="spinner"></div>
                  </div>
                </div>
              </template>
              <div class="pull-right">
                <button class="btn btn-danger" type="button" data-on-click="onItemEditingCancelClick(item, $event)">
                  Cancel
                </button>
                <button class="btn btn-primary" type="submit">
                  Edit
                </button>
              </div>
            </form>
          </template>
          <template data-bind-ngIf="item.importing">
            <form class="clearfix" data-on-submit="onItemImportingSubmit(item, $event)">
              <div class="form-group">
                <label>
                  <span class="glyphicon glyphicon-list"></span>
                  Project
                </label>
                <select class="form-control" required data-bindon-ngModel="item.interactionsProjectField" data-on-ngModelChange="item.interactionsNameField = ''">
                  <option value="">Select name...</option>
                  <option data-bind-value="project.id" template="ngFor let project of projects">
                    {{project.project_name}}
                  </option>
                </select>
              </div>
              <template data-bind-ngIf="item.interactionsProjectField">
                <div class="form-group">
                  <label>
                    <span class="glyphicon glyphicon-pencil"></span>
                    Name
                  </label>
                  <input class="form-control" required minlength="8" data-bindon-ngModel="item.interactionsNameField" data-bind-customValidator="validateInteractionsSchemeName(item.interactionsNameField, item.interactionsProjectField)" data-message="This name is used already. Please choose another one.">
                </div>
                <div class="form-group">
                  <label>
                    <span class="glyphicon glyphicon-pencil"></span>
                    Description
                  </label>
                  <textarea class="form-control" data-bindon-ngModel="item.interactionsDescriptionField"></textarea>
                </div>
                <div class="form-group">
                  <label>
                    <span class="glyphicon glyphicon-link"></span>
                    Scheme
                  </label>
                  <div data-bindon-fieldInteractionsScheme="item.interactionsSchemeField">
                    <div class="spinner"></div>
                  </div>
                </div>
              </template>
              <div class="pull-right">
                <button class="btn btn-danger" type="button" data-on-click="onItemImportingCancelClick(item, $event)">
                  Cancel
                </button>
                <button class="btn btn-primary" type="submit">
                  Import
                </button>
              </div>
            </form>
          </template>
          <template data-bind-ngIf="item.removing">
            <div class="pull-right">
              <button class="btn btn-danger" type="button" data-on-click="onItemRemovingYesClick(item, $event)">Yes</button>
              <button class="btn btn-default" type="button" data-on-click="onItemRemovingNoClick(item, $event)">No</button>
            </div>
            Do you really want to remove this?
          </template>
          <template data-bind-ngIf="!item.editing && !item.importing && !item.removing">
            <template data-bind-ngIf="item.interactionsSchemeField != null || item.markable || item.confirmable || item.editItem || item.removeItem">
              <div class="dropdown dropdown-kebab-pf pull-right">
                <button class="btn btn-link dropdown-toggle" type="button">
                  <span class="fa fa-ellipsis-v"></span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right">
                  <template data-bind-ngIf="item.interactionsSchemeField != null">
                    <li><a data-on-click="onItemImportClick(item, $event)" style="cursor: pointer">Import</a></li>
                  </template>
                  <template data-bind-ngIf="item.markable">
                    <li><a data-on-click="onItemMarkClick(item, $event)" style="cursor: pointer">Mark</a></li>
                  </template>
                  <template data-bind-ngIf="item.confirmable">
                    <li><a data-on-click="onItemConfirmationAddClick(item, $event)" style="cursor: pointer">Confirm</a></li>
                  </template>
                  <template data-bind-ngIf="item.editItem">
                    <li><a data-on-click="onItemEditClick(item, $event)" style="cursor: pointer">Edit</a></li>
                  </template>
                  <template data-bind-ngIf="item.removeItem">
                    <li><a data-on-click="onItemRemoveClick(item, $event)" style="cursor: pointer">Remove</a></li>
                  </template>
                </ul>
              </div>
            </template>
            <div data-bindon-fieldIssueBody="item.body" data-bind-readonly="true">
              <div class="spinner"></div>
            </div>
            <template ngFor data-let-tag data-bind-ngForOf="item.tags">
              <span class="label label-default">{{tag}}</span>
            </template>
            <p class="pull-right">{{item.author}} - {{item.date}}</p>
          </template>
        </div>
        <div class="panel-footer">
          <div template="ngFor let comment of item.comments">
            <div class="media" style="overflow: visible">
              <div class="media-left">
                <img class="media-object" src="...">
              </div>
              <div class="media-body" style="overflow: visible">
                <template data-bind-ngIf="comment.editing">
                  <form class="clearfix" data-on-submit="onCommentEditingSubmit(comment, $event)">
                    <div class="form-group">
                      <label>
                        <span class="glyphicon glyphicon-comment"></span>
                        Comment
                      </label>
                      <textarea class="form-control" required minlength="4" data-bindon-ngModel="comment.bodyField"></textarea>
                    </div>
                    <div class="pull-right">
                      <button class="btn btn-danger" type="button" data-on-click="onCommentEditingCancelClick(comment, $event)">
                        Cancel
                      </button>
                      <button class="btn btn-primary" type="submit">
                        Edit
                      </button>
                    </div>
                  </form>
                </template>
                <template data-bind-ngIf="comment.removing">
                  <div class="pull-right">
                    <button class="btn btn-danger" type="button" data-on-click="onCommentRemovingYesClick(comment, $event)">Yes</button>
                    <button class="btn btn-default" type="button" data-on-click="onCommentRemovingNoClick(comment, $event)">No</button>
                  </div>
                  Do you really want to remove this comment?
                </template>
                <template data-bind-ngIf="!comment.editing && !comment.removing">
                  <div class="media-heading" style="font-weight: bold;">
                    {{comment.author}} - {{comment.date}}
                    <div class="pull-right">
                      <div class="btn-group btn-group-xs">
                        <button class="btn btn-default" type="button" data-on-click="onPlusClick(comment.id, $event)">
                          <span class="glyphicon glyphicon-thumbs-up"></span>
                        </button>
                        <div style="float: left;padding: 1px 5px;">
                          {{comment.likes}}
                        </div>
                        <button class="btn btn-default" type="button" data-on-click="onMinusClick(comment.id, $event)">
                          <span class="glyphicon glyphicon-thumbs-down"></span>
                        </button>
                      </div>
                      <template data-bind-ngIf="comment.editComment || comment.removeComment">
                        <div class="dropdown dropdown-kebab-pf pull-right" style="margin-left: 10px">
                          <button class="btn btn-link dropdown-toggle" type="button">
                            <span class="fa fa-ellipsis-v"></span>
                          </button>
                          <ul class="dropdown-menu dropdown-menu-right">
                            <template data-bind-ngIf="comment.editComment">
                              <li><a data-on-click="onCommentEditClick(comment, $event)" style="cursor: pointer">Edit</a></li>
                            </template>
                            <template data-bind-ngIf="comment.removeComment">
                              <li><a data-on-click="onCommentRemoveClick(comment, $event)" style="cursor: pointer">Remove</a></li>
                            </template>
                          </ul>
                        </div>
                      </template>
                    </div>
                  </div>
                  {{comment.body}}
                </template>
              </div>
            </div>
            <hr>
          </div>
          <template data-bind-ngIf="item.commentItem">
            <div class="media">
              <div class="media-left">
                <img class="media-object" src="...">
              </div>
              <form class="media-body" data-on-submit="onCommentCreationSubmit(item, $event)">
                <div class="input-group">
                  <input class="form-control" type="text" required minlength="4" data-bindon-ngModel="item.commentField">
                  <span class="input-group-btn">
                    <button class="btn btn-primary" type="submit">Comment</button>
                  </span>
                </div>
              </form>
            </div>
          </template>
        </div>
      </div>
    </div>
  </div>
  <template data-bind-ngIf="createAnswer">
    <div class="panel panel-default">
      <form class="panel-body clearfix" data-on-submit="onAnswerCreationSubmit($event)">
        <div class="form-group">
          <label>
            <span class="glyphicon glyphicon-pencil"></span>
            New Answer
          </label>
          <div data-bindon-fieldIssueBody="answerBodyField" data-bind-required="true">
            <div class="spinner"></div>
          </div>
        </div>
        <button class="btn btn-primary pull-right" type="submit">Create</button>
      </form>
    </div>
  </template>
</div>
