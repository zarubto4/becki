<!--
  ~ © 2015-2016 Becki Authors. See the AUTHORS file found in the top-level
  ~ directory of this distribution.
  -->

<bk-layout-main
    [tabMenu]="(project_Id == null ? 'byzance-admin' : 'projects-project')"
    [show_title]="!project_Id"
    [title]="project_Id == null ? ('main_title'|bkTranslate:this) : currentParamsService.currentProjectNameSnapshot"
    [subtitle]="project_Id == null ? ('main_subtitle'|bkTranslate:this) : currentParamsService.currentProjectDescriptionSnapshot">

    <!-- Portlet - Basic Title of Panel with Buttons on right side -- START -->
    <bk-portlet-title *ngIf="codeProgram"
                      [title_name]="'title'|bkTranslate:this"
                      [title_object_name]="codeProgram.name"
                      [title_object_description]="codeProgram.description"
                      [icon]="'fa-tachometer'"
                      (onClick)="onPortletClick($event)"
                      [btns_group_name]="'btn_label_option'|bkTranslate:this"
                      [btns]="[
                                 {
                                      condition: (codeProgram && codeProgram.update_permission),
                                      btn_label_for_person: ('label_program_properties'|bkTranslate:this),
                                      icon: 'fa-cog',
                                      permission: (codeProgram && codeProgram.update_permission),
                                      colorType: 'EDIT',
                                      btn_tag: 'edit_program'
                                 },
                                 {
                                      condition: (codeProgram && codeProgram.delete_permission),
                                      btn_label_for_person: ('label_remove_program'|bkTranslate:this),
                                      icon: 'fa-trash',
                                      permission: (codeProgram && codeProgram.delete_permission),
                                      colorType: 'REMOVE',
                                      btn_tag: 'remove_program'
                                 },
                                 {
                                      condition: (codeProgram && codeProgram.publish_type == 'PUBLIC'),
                                      btn_label_for_person: ('label_make_copy'|bkTranslate:this),
                                      icon: 'fa-clone',
                                      permission: (true),
                                      colorType: 'CLONE',
                                      btn_tag: 'make_clone'
                                 }
                    ]"
                    (onTabClick)="onToggleTab($event)"
                    [tab_selected_name]="tab"
                    [tabBtns]="[
                                {
                                    tab_name: 'ide',
                                    condition: (true),
                                    tab_color: 'CODE',
                                    permission: true,
                                    tab_label: ('tab_ide'|bkTranslate:this)
                                },
                                {
                                    tab_name: 'versions',
                                    condition: (true),
                                    tab_color: 'CODE',
                                    permission: true,
                                    tab_label: ('tab_versions'|bkTranslate:this)
                                 }
                    ]">
    </bk-portlet-title>
    <!-- Portlet - Basic Title of Panel with Buttons on right side --- END -->


    <!-- Page Content IDE -- START -->
    <div class="portlet-body">

        <div [hidden]="tab!='ide'">
            <bk-code-ide [files]="selectedCodeFiles"
                         [defaultOpenFilename]="'main.cpp'"
                         (fileContentChange)="onFileContentChange($event)"
                         [enableLibraryButtons]="true"
                         [enableSaveButton]="codeProgram && codeProgram.update_permission"
                         [enableBuildButton]="true"
                         [buildInProgress]="buildInProgress"
                         [selectedHardware]="selected_hardware"
                         (onBuildClick)="onBuildClick($event)"
                         (onSaveAsClick)="saveAsCode()"
                         (onSaveClick)="onSaveClick()"
                         (onAddLibraryClick)="onAddLibraryClick()"
                         (onAddHardwareClick)="onAddDeveloperHardwareClick()"
                         (onRemoveHardwareClick)="onRemoveDeveloperHardwareClick($event)"
                         (onChangeLibraryVersionClick)="onChangeLibraryVersionClick($event)"
                         [libraryCompilationVersionOptions]="libraryCompilationVersionOptions"
                         #CodeIDEComponent>
            </bk-code-ide>
        </div>

        <div [hidden]="tab!='versions'">
            <div *ngIf="codeProgramVersions && codeProgramVersions.length > 0"  class="table-scrollable table-scrollable-borderless">
                <table class="table table-hover table-light byzance-table">
                    <thead>
                    <tr>
                        <th class="">{{'table_name'|bkTranslate:this}}</th>
                        <th *ngIf="!projectId"></th>
                        <th class="">{{'table_description'|bkTranslate:this}}</th>
                        <th class="">{{'table_lib_version'|bkTranslate:this}}</th>
                        <th class="">{{'table_author'|bkTranslate:this}}</th>
                        <th class="">{{'table_status'|bkTranslate:this}}</th>
                        <th class=""></th>
                        <th class="text-center">{{'table_actions'|bkTranslate:this}}</th>
                    </tr>
                    </thead>
                    <tbody class="hide-bk-drob-down-button">
                    <tr *ngFor="let version of codeProgramVersions">

                        <!-- NAME -->
                        <td class="vert-align no-wrap" [class.bold]="isSelected(version)">
                            <a (click)="onProgramVersionClick(version)">
                                {{version.name}}
                            </a>
                        </td>

                        <!-- Main Mark - Only for settings for Type of Board, If C program is not for user projects -->
                        <td *ngIf="!projectId" class="vert-align">
                             <span class="icon-hint-wraper green" *ngIf="version.main_mark">
                                  <i class="fa fa-lg fa-flag font-green-jungle"></i>
                                  <span class="hint">{{'main_version'|bkTranslateTable:this:'version_status'}}</span>
                             </span>
                        </td>

                        <!-- Description -->
                        <td class="vert-align">
                            {{version.description}}
                        </td>

                        <!-- Description -->
                        <td class="vert-align no-wrap">
                            {{version.compilation_version}}
                        </td>

                        <!-- Author -->
                        <td class="vert-align no-wrap">
                            <span *ngIf="version.author">{{version.author.nick_name}}</span>
                            <span *ngIf="!version.author">No One</span>
                        </td>
                        <!-- STATUS -->
                        <td class="vert-align  text-center">
                            <bk-compilation-status-component [status]="version.status"></bk-compilation-status-component>
                            <bk-compilation-status-component [status]="version.approval_state"></bk-compilation-status-component>
                        </td>
                        <!-- UPLOAD -->

                        <td class="vert-align no-wrap">
                            <button *ngIf="projectId && hardwareType && hardwareType.connectible_to_internet && version.status=='SUCCESS' && codeProgram && codeProgram.publish_type == 'PRIVATE'" class="btn blue">
                                {{'btn_upload_to_hardware'|bkTranslate:this}}
                            </button>
                        </td>

                        <!-- ACTIONS -->
                        <td class="action-btn-col">

                                <bk-drob-down-button
                                    [btns_group_name]="('label_version_properties'|bkTranslate:this)"
                                    [btns]="[
                                    {
                                        condition: (version.download_link_bin_file != null && version.status === 'SUCCESS'),
                                        btn_label_for_person: ('label_download_file'|bkTranslate:this),
                                        btn_tag: 'download_file',
                                        icon: 'fa-cloud-download',
                                        colorType: 'CREATE',
                                        btn_link: version.download_link_bin_file,
                                        permission: (version.update_permission)
                                    },
                                    {
                                        condition: version.update_permission && !version.working_copy,
                                        btn_label_for_person: ('label_version_properties'|bkTranslate:this),
                                        btn_tag: 'version_properties',
                                        icon: 'fa-cog',
                                        colorType: 'EDIT',
                                        permission: (version.update_permission)
                                    },
                                    {
                                        condition: (project_Id != null && version.approval_state == null && !version.working_copy),
                                        btn_label_for_person: ('label_publish'|bkTranslate:this),
                                        btn_tag: 'version_properties_community',
                                        icon: 'fa-heart',
                                        colorType: 'UPDATE',
                                        permission: (version.update_permission)
                                    },
                                    {
                                        condition: version.approval_state == 'PENDING' && version.community_publishing_permission && !version.working_copy,
                                        btn_label_for_person: ('label_publish_decision'|bkTranslate:this),
                                        btn_tag: 'version_publish',
                                        icon: 'fa-heart',
                                        colorType: 'UPDATE',
                                        permission: (version.update_permission)
                                    },
                                    {
                                        condition: markupableAsMain(version) && !version.working_copy,
                                        btn_label_for_person: ('label_main_c_program_version_set_as_main'|bkTranslate:this),
                                        btn_tag: 'set_as_main',
                                        icon: 'fa-flag',
                                        colorType: 'ACTIVE',
                                        permission: (hardwareType && !hardwareType.update_permission)
                                    },
                                    {
                                        condition: true,
                                        btn_label_for_person: ('label_remove_version'|bkTranslate:this),
                                        btn_tag: 'remove_version',
                                        icon: 'fa-trash',
                                        colorType: 'REMOVE',
                                        permission: (version.delete_permission)
                                    }
                                ]"
                                    (onValueChanged)="onDrobDownEmiter($event, version)"
                                >
                                </bk-drob-down-button>

                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Temporary page content if content is being loaded or if there is no content -- START -->
            <bk-nothing-to-show [condition_loading]="(codeProgramVersions == null)"
                                [condition_empty]="(codeProgramVersions != null && codeProgramVersions.length == 0)"
                                [main_message_link]="'label_no_c_program_versions'|bkTranslate:this"
                                [main_message_comment_link]="'label_no_c_program_versions_comment'|bkTranslate:this"
                                [show_button]="false">
            </bk-nothing-to-show>
            <!-- Temporary page content if content is being loaded or if there is no content -- END -->
        </div>

    </div>
    <!-- Page Content IDE -- END -->

    <!-- Page Content UNDER IDE -- START -->
    <div [hidden]="tab!='ide'" class="portlet-body">

        <!-- Portlet - Basic Title of Panel with Buttons on right side -- START -->
        <bk-portlet-title [show_title]="false"
                          (onTabClick)="onToggleIDETab($event)"
                          [tab_selected_name] = "tab_under_ide"
                          [tabBtns]="[
                                {
                                    tab_name: 'error_list',
                                    condition: (true),
                                    tab_color: 'CODE',
                                    tab_label: ('tab_error_list'|bkTranslate:this)
                                },
                                {
                                    tab_name: 'console_log',
                                    condition: (true),
                                    tab_color: 'CODE',
                                    tab_label: ('tab_online_terminal'|bkTranslate:this)
                                }
                          ]">
        </bk-portlet-title>
        <!-- Portlet - Basic Title of Panel with Buttons on right side --- END -->

        <!--- Error Tabs -->
        <div *ngIf="tab_under_ide == 'error_list'">

            <div *ngIf="(buildErrors && buildErrors.length)">
                <div *ngFor="let buildError of buildErrors" class="mt-element-ribbon bg-grey-steel">
                    <div class="ribbon ribbon-shadow uppercase"
                         [class.ribbon-color-danger]="buildError.type=='error'"
                         [class.ribbon-color-warning]="buildError.type=='warning'">{{buildError.type}}</div>
                    <p class="ribbon-content">
                        <span [innerHTML]="'label_file_and_line'|bkTranslate:this:buildError.filename:buildError.line"></span>
                        <br>
                        <b>{{buildError.text}}</b>
                        <br>
                        <code>{{buildError.code}}</code>
                    </p>
                </div>
            </div>

            <!-- Temporary page content if content is being loaded or if there is no content -- START -->
            <bk-nothing-to-show [condition_loading]="(buildInProgress)"
                                [condition_empty]="(buildErrors != null && buildErrors.length == 0)"
                                [main_message_link]="'label_no_errors'|bkTranslate:this"
                                [main_message_comment_link]="'label_no_errors_description'|bkTranslate:this"
                                [show_button]="false">
            </bk-nothing-to-show>
            <!-- Temporary page content if content is being loaded or if there is no content -- END -->

        </div>
        <!--- Error Tabs END -->

        <div *ngIf="tab_under_ide == 'console_log'">
            Zatím nic....
        </div>

    </div>
    <!-- Page Content UNDER IDE -- END -->

</bk-layout-main>
