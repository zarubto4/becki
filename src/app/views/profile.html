<!--
~ Â© 2016 Becki Authors. See the AUTHORS file found in the top-level
~ directory of this distribution.
-->


<bk-layout-main [title]="'main_title'|bkTranslate:this">

    <!-- Portlet - Basic Title of Panel with Buttons on right side -- START -->
    <bk-portlet-title
        [title_name]="'title'|bkTranslate:this"
        [icon]="'fa-user'"
        (onClick)="onPortletClick($event)"
        (onTabClick)="onToggleTab($event)"
        [tab_selected_name]="tab"
        [tabBtns]="[
                        {
                            condition: (person && person.update_permission),
                            tab_name: 'personal',
                            tab_color: 'BYZANCE',
                            tab_label: ('nav_personal_info'|bkTranslate:this)
                        },
                        {
                            condition: (person && person.update_permission),
                            tab_name: 'avatar',
                            tab_color: 'BYZANCE',
                            tab_label: ('nav_avatar'|bkTranslate:this)
                        },
                        {
                            condition: (person && person.update_permission),
                            tab_name: 'password',
                            tab_color: 'BYZANCE',
                            tab_label: ('nav_password'|bkTranslate:this)
                        },
                        {
                            condition: (person && person.update_permission),
                            tab_name: 'email',
                            tab_color: 'BYZANCE',
                            tab_label: ('nav_email'|bkTranslate:this)
                        },
                        {
                             condition: (person && person.update_permission),
                            tab_name: 'logins',
                            tab_color: 'HARDBYZANCEWARE',
                            tab_label: ('nav_logins'|bkTranslate:this)
                        }
                    ]"
        [btns]="[
                    {
                        condition: (tab === 'logins'),
                        btn_label_for_person: ('btn_add_apikey'|bkTranslate:this),
                        icon: 'fa-plus-circle',
                        colorType: 'ADD',
                        permission: true,
                        btn_tag: 'add_apikey'
                    }
                ]"
    >
    </bk-portlet-title>
    <!-- Portlet - Basic Title of Panel with Buttons on right side --- END -->

    <!-- Page Content -- START -->
    <div class="portlet-body">
        <div *ngIf="person" class="tab-content">

            <!-- PERSONAL TAB -->
            <div class="tab-pane" [class.active]="tab == 'personal'">
                <form>
                    <bk-form-input [label]="'label_first_name'|bkTranslate:this" type="text"
                                   [control]="infoForm.controls['first_name']"></bk-form-input>
                    <bk-form-input [label]="'label_last_name'|bkTranslate:this" type="text"
                                   [control]="infoForm.controls['last_name']"></bk-form-input>
                    <bk-form-input [label]="'label_nick_name'|bkTranslate:this" type="text"
                                   [control]="infoForm.controls['nickName']"></bk-form-input>
                    <bk-form-select [label]="'label_gender'|bkTranslate:this" [regexFirstOption]="person.gender"  [options]="genderList"
                                    [control]="infoForm.controls['gender']"></bk-form-select>
                    <bk-form-select [label]="'label_state'|bkTranslate:this"  [regexFirstOption]="person.country" [options]="countryList"
                                    [control]="infoForm.controls['country']"></bk-form-select>

                    <div *ngIf="person.update_permission" class="margin-top-10">
                        <button (click)="changeInfo()" class="btn green">{{'btn_save'|bkTranslate:this}}</button>
                    </div>
                </form>
            </div>
            <!-- END PERSONAL TAB -->


            <!-- AVATAR TAB -->
            <div class="tab-pane center-align center text-center" [class.active]="tab == 'avatar'">
                <img *ngIf="person.picture_link" class="preview img-circle center-align center"
                     [src]="person.picture_link" width="128" height="128">
                <img *ngIf="!person.picture_link" class="preview img-circle empty center-align center" width="128"
                     height="128">

                <p class="text-center"><a (click)="updatePictureClick()" class="font-grey-mint">{{'label_set_own_picture'|bkTranslate:this}}</a>
                </p>
            </div>
            <!-- END AVATAR TAB -->


            <!-- PASSWORD TAB -->
            <div class="tab-pane" [class.active]="tab === 'password'">
                <form>
                    <bk-form-input [label]="'label_current_password'|bkTranslate:this" type="password"
                                   [control]="passwordForm.controls['currentPassword']"></bk-form-input>
                    <bk-form-input [label]="'label_new_password'|bkTranslate:this" type="password"
                                   [control]="passwordForm.controls['newPassword']"></bk-form-input>
                    <bk-form-input [label]="'label_new_password_again'|bkTranslate:this" type="password"
                                   [control]="passwordForm.controls['newPasswordConfirm']"></bk-form-input>

                    <div *ngIf="person.update_permission" class="margin-top-10">
                        <button type="submit" (click)="changePassword()" class="btn green"
                                [disabled]="!passwordForm.valid">{{'btn_change_password'|bkTranslate:this}}
                        </button>
                    </div>
                </form>
            </div>
            <!-- END PASSWORD TAB -->


            <!-- EMAIL TAB -->
            <div class="tab-pane" [class.active]="tab === 'email'">
                <form>
                    <bk-form-input [label]="'label_current_email'|bkTranslate:this" type="email"
                                   [control]="emailForm.controls['currentEmail']"></bk-form-input>
                    <bk-form-input [label]="'label_new_email'|bkTranslate:this" type="email"
                                   [control]="emailForm.controls['newEmail']"></bk-form-input>
                    <bk-form-input [label]="'label_new_email_again'|bkTranslate:this" type="email"
                                   [control]="emailForm.controls['newEmailConfirm']"></bk-form-input>

                    <div *ngIf="person.update_permission" class="margin-top-10">
                        <button type="submit" (click)="changeEmail()" class="btn green" [disabled]="!emailForm.valid">
                            {{'btn_change_email'|bkTranslate:this}}
                        </button>
                    </div>
                </form>
            </div>
            <!-- END EMAIL TAB -->

            <div class="tab-pane" [class.active]="tab === 'logins'">
                <div *ngIf="login_tokens && login_tokens.length">
                    <bk-portlet-title [title_name]="'label_login_tokens'|bkTranslate:this"
                                      [icon]="'fa-sitemap fa-rotate-90'">
                    </bk-portlet-title>

                    <div class="portlet-body">
                        <div class="table-scrollable">
                            <table class="table table-hover">
                                <thead>
                                <tr>
                                    <th class="center-align">{{'table_system_component'|bkTranslate:this}}</th>
                                    <th class="center-align">{{'table_user_agent'|bkTranslate:this}}</th>
                                    <th class="center-align">{{'table_created'|bkTranslate:this}}</th>
                                    <th class="center-align">{{'table_access_age'|bkTranslate:this}}</th>
                                    <th class="text-center">{{'table_actions'|bkTranslate:this}}</th>
                                </tr>
                                </thead>
                                <tbody class="hide-bk-drob-down-button">
                                <tr *ngFor="let login_token of login_tokens">
                                    <td class="vert-align">
                                        <span *ngIf="login_token.where_logged == 'BECKI_WEBSITE'">Byzance Portal</span>
                                    </td>
                                    <td class="vert-align">{{login_token.user_agent}}</td>
                                    <td class="vert-align no-wrap">{{login_token.created|bkUnixTimeToDate}}</td>
                                    <td class="vert-align no-wrap">{{login_token.access_age|bkUnixTimeToDate}}</td>

                                    <td class="action-btn-col">

                                        <bk-drob-down-button
                                            [btns_group_name]="('label_token_remove'|bkTranslate:this)"
                                            [btns]="[
                                        {
                                            condition: login_token.delete_permission,
                                            btn_label_for_person: ('label_token_remove'|bkTranslate:this),
                                            btn_tag: 'login_token_delete',
                                            icon: 'fa-trash',
                                            colorType: 'REMOVE',
                                            permission: (login_token.delete_permission)
                                        }
                                        ]"
                                            (onValueChanged)="onDrobDownEmiter($event, login_token)"
                                        >
                                        </bk-drob-down-button>

                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div *ngIf="permanent_tokens && permanent_tokens.length">
                    <bk-portlet-title [title_name]="'label_apikeys'|bkTranslate:this"
                                      [icon]="'fa-sitemap fa-rotate-90'">
                    </bk-portlet-title>

                    <div class="portlet-body">
                        <div class="table-scrollable">
                            <table class="table table-hover">
                                <thead>
                                <tr>
                                    <th class="center-align">{{'table_system_component'|bkTranslate:this}}</th>
                                    <th class="center-align">{{'table_value'|bkTranslate:this}}</th>
                                    <th class="center-align">{{'table_user_agent'|bkTranslate:this}}</th>
                                    <th class="center-align">{{'table_created'|bkTranslate:this}}</th>
                                    <th class="center-align">{{'table_access_age'|bkTranslate:this}}</th>
                                    <th class="text-center">{{'table_actions'|bkTranslate:this}}</th>
                                </tr>
                                </thead>
                                <tbody class="hide-bk-drob-down-button">
                                <tr *ngFor="let login_token of permanent_tokens">
                                    <td class="vert-align">
                                        <span *ngIf="login_token.where_logged == 'BECKI_WEBSITE'">Byzance Portal</span>
                                    </td>
                                    <td class="vert-align">{{login_token.token}}</td>
                                    <td class="vert-align">{{login_token.user_agent}}</td>
                                    <td class="vert-align no-wrap">{{login_token.created|bkUnixTimeToDate}}</td>
                                    <td class="vert-align no-wrap">{{'label_forever'|bkTranslate:this}}</td>

                                    <td class="action-btn-col">

                                        <bk-drob-down-button
                                            [btns_group_name]="('label_token_remove'|bkTranslate:this)"
                                            [btns]="[
                                        {
                                            condition: login_token.delete_permission,
                                            btn_label_for_person: ('label_token_remove'|bkTranslate:this),
                                            btn_tag: 'login_token_delete',
                                            icon: 'fa-trash',
                                            colorType: 'REMOVE',
                                            permission: (login_token.delete_permission)
                                        }
                                        ]"
                                            (onValueChanged)="onDrobDownEmiter($event, login_token)"
                                        >
                                        </bk-drob-down-button>

                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <h3 *ngIf="!login_tokens" class="text-center">{{'label_loading'|bkTranslate:this}}</h3>
            </div>

        </div>
    </div>
    <!-- Page Content -- END -->

</bk-layout-main>
