<!--
  ~ Â© 2015-2016 Becki Authors. See the AUTHORS file found in the top-level
  ~ directory of this distribution.
  -->

<bk-layout-main tabMenu="projects-project" [title]="currentParamsService.currentProjectNameSnapshot"
                [subtitle]="currentParamsService.currentProjectDescriptionSnapshot">

    <div class="portlet portlet light bordered">
        <div class="portlet-title">
            <div class="becki-caption">
                <span class="font-blue-dark">
                    <i class="fa fa-fw fa-microchip"></i>
                       <span [innerHTML]="'title'|bkTranslate:this"></span>
                </span>
            </div>
            <div *ngIf="tab == 'hardware_list' && (devicesFilter && devicesFilter.content.length)" class="becki-actions">
                <button class="btn blue" (click)="onAddClick()">
                    <i class="fa fa-plus-circle"></i> {{'btn_add_hardware'|bkTranslate:this}}
                </button>
            </div>

            <div *ngIf="tab == 'hardware_groups' && (deviceGroup && deviceGroup.length)" class="becki-actions">
                <button class="btn blue" (click)="onGroupAddClick()">
                    <i class="fa fa-plus-circle"></i> {{'btn_add_hardware_group'|bkTranslate:this}}
                </button>
            </div>

            <div *ngIf="tab == 'updates' && (actualizationList && actualizationList.content.length)" class="becki-actions">
                <button class="btn blue" (click)="onProcedureCreateClick()">
                    <i class="fa fa-plus-circle"></i> {{'btn_add_new_update'|bkTranslate:this}}
                </button>
            </div>
        </div>

        <div class="portlet-title tabbable-line">
            <ul class="nav nav-tabs pull-left margin-left-15">
                <li [class.active]="tab == 'hardware_list'">
                    <a class="cursor-pointer" (click)="onToggleTab('hardware_list')">{{'tab_hardware_list'|bkTranslate:this}}</a>
                </li>
                <li [class.active]="tab == 'hardware_groups'">
                    <a class="cursor-pointer" (click)="onToggleTab('hardware_groups')">{{'tab_hardware_groups'|bkTranslate:this}}</a>
                </li>
                <li [class.active]="tab == 'updates'">
                    <a class="cursor-pointer" (click)="onToggleTab('updates')">{{'tab_updates'|bkTranslate:this}}</a>
                </li>
            </ul>
        </div>

        <div *ngIf="tab == 'hardware_list'">
            <!--Filter Parameters -->
            <div>

            </div>
            <div *ngIf="(devicesFilter && devicesFilter.content.length > 0)" class="table-scrollable">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th class="">{{'table_name'|bkTranslate:this}}</th>
                            <th class="">{{'table_hardware_id'|bkTranslate:this}}</th>
                            <th class="no-wrap">{{'table_description'|bkTranslate:this}}</th>
                            <th class="no-wrap"><strong class="font-color-hardware">Hardware</strong>{{'label_type'|bkTranslate:this}}</th>
                            <th class="no-wrap">{{'table_groups'|bkTranslate:this}}</th>
                            <th class="no-wrap">{{'table_status'|bkTranslate:this}}</th>
                            <th class="col col-lg-1 text-right no-wrap">{{'table_actions'|bkTranslate:this}} &nbsp;&nbsp;</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let device of devicesFilter.content">
                            <td class="vert-align no-wrap">
                                <div class="icon-hint-wraper red" *ngIf="device.alert_list && device.alert_list.length > 0">
                                    <i class="fa fa-fw fa-exclamation-triangle font-red-flamingo"></i>
                                    <div class="hint-fixed">
                                        <span class="hint right">
                                            <div *ngFor="let alert of device.alert_list" class="no-wrap">{{alert|bkTranslateTable:this:'device_alerts'}}</div>
                                        </span>
                                    </div>
                                </div>
                                <a (click)="onDeviceClick(device)"
                                   class="no-wrap"><strong>{{device.name?device.name:device.id}}</strong></a>
                            </td>
                            <td class="vert-align no-wrap">{{device.id}}</td>
                            <td class="vert-align no-wrap">{{device.description}}</td>
                            <td class="vert-align no-wrap"><a (click)="onBoardTypeClick(device.type_of_board_id)">{{device.type_of_board_name}}</a></td>
                            <td class="vert-align no-wrap">

                                <div *ngIf="!device.hardware_groups">
                                    -
                                </div>
                                <div *ngIf="device.hardware_groups">
                                    [
                                    <span *ngFor="let group of device.hardware_groups; let last = last">
                                        {{group.name}}<span *ngIf="!last">, </span>
                                    </span>
                                    ]
                                </div>


                            </td>

                            <td class="no-wrap">
                                <span *ngIf="device.online_state == 'online'" class="font-green-jungle bold">{{device.online_state|bkTranslateTable:this:'online_status'}}</span>
                                <span *ngIf="device.online_state == 'offline'" class="font-red bold">{{device.online_state|bkTranslateTable:this:'online_status'}}</span>
                                <span *ngIf="device.online_state == 'synchronization_in_progress'"
                                      class="font-grey-mint bold"><i class="fa fa-spinner fa-spin"></i></span>
                                <span *ngIf="device.online_state == 'not_yet_first_connected'" class="font-grey-mint bold">{{device.online_state|bkTranslateTable:this:'online_status'}}</span>
                                <span *ngIf="device.online_state == 'unknown_lost_connection_with_server'"
                                      class="font-grey-mint bold">{{device.online_state|bkTranslateTable:this:'online_status'}}</span>
                            </td>
                            <td class="vert-align no-wrap">

                                <style type="text/css">
                                    table tr button {
                                        opacity: 0.05;
                                    }
                                    table tr:hover button {
                                        opacity: 1
                                    }
                                </style>

                                <button title="{{'label_hardware_group'|bkTranslate:this}}" class="btn btn-icon-only yellow-casablanca"
                                        [disabled]="!device.edit_permission"
                                        (click)="onDeviceEditGroupClick(device)">
                                    <i class="fa fa-object-group"></i>
                                </button>
                                <button title="{{'label_device_properties'|bkTranslate:this}}" class="btn btn-icon-only blue"
                                        [disabled]="!device.edit_permission"
                                        (click)="onEditClick(device)">
                                    <i class="fa fa-cog"></i>
                                </button>
                                <button title="{{'label_remove_device'|bkTranslate:this}}" class="btn btn-icon-only red"
                                        [disabled]="!device.delete_permission"
                                        (click)="onRemoveClick(device)">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <bk-filter-page-component [from]="devicesFilter.from" [to]="devicesFilter.to" [total]="devicesFilter.total"  [totalPages]="devicesFilter.pages" (onSelect)="selectedFilterPageHardware($event)"></bk-filter-page-component>
            </div>
            <h3 *ngIf="!devicesFilter" class="text-center">{{'label_loading'|bkTranslate:this}}</h3>
            <div *ngIf="devicesFilter && devicesFilter.content.length == 0" class="list-no-items">
                <p class="list-no-items__main-label"><span [innerHTML]="'label_no_hardware'|bkTranslate:this"></span></p>
                <p class="list-no-items__sub-label">{{'label_no_hardware_comment'|bkTranslate:this}}</p>
                <p>
                    <button class="btn blue" (click)="onAddClick($event)">
                        <i class="fa fa-plus-circle"></i> {{'btn_add_hardware'|bkTranslate:this}}
                    </button>
                </p>
            </div>
        </div>

        <div *ngIf="tab == 'hardware_groups'">
            <div *ngIf="(deviceGroup && deviceGroup.length > 0)" class="table-scrollable">
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th class="col col-lg-3">{{'table_name'|bkTranslate:this}}</th>
                        <th class="col col-lg-5">{{'table_description'|bkTranslate:this}}</th>
                        <th class="col col-lg-2">{{'table_size'|bkTranslate:this}}</th>
                        <th class="col col-lg-1 text-right no-wrap">{{'table_actions'|bkTranslate:this}} &nbsp;&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr *ngFor="let group of deviceGroup">

                        <td class="vert-align no-wrap">{{group.name}}</td>
                        <td class="vert-align no-wrap">{{group.description}}</td>
                        <td class="vert-align no-wrap">{{group.group_size}}</td>

                        <td class="vert-align no-wrap">

                            <style type="text/css">
                                table tr button {
                                    opacity: 0.05;
                                }

                                table tr:hover button {
                                    opacity: 1
                                }
                            </style>

                            <button title="{{'label_device_properties'|bkTranslate:this}}" class="btn btn-icon-only blue"
                                    [disabled]="!group.edit_permission"
                                    (click)="onGroupEditClick(group)">
                                <i class="fa fa-cog"></i>
                            </button>
                            <button title="{{'label_remove_device'|bkTranslate:this}}" class="btn btn-icon-only red"
                                    [disabled]="!group.delete_permission"
                                    (click)="onGroupDeleteClick(group)">
                                <i class="fa fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <h3 *ngIf="!deviceGroup" class="text-center">{{'label_loading'|bkTranslate:this}}</h3>
            <div *ngIf="deviceGroup && deviceGroup.length == 0" class="list-no-items">
                <p class="list-no-items__main-label"><span [innerHTML]="'label_no_hardware_group'|bkTranslate:this"></span></p>
                <p class="list-no-items__sub-label">{{'label_no_hardware_group_comment'|bkTranslate:this}}</p>
                <p>
                    <button class="btn blue" (click)="onGroupAddClick()">
                        <i class="fa fa-plus-circle"></i> {{'btn_add_hardware_group'|bkTranslate:this}}
                    </button>
                </p>
            </div>
        </div>



        <div *ngIf="tab == 'updates'">
            <div *ngIf="(actualizationList && actualizationList.content.length > 0)" class="table-scrollable">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th class="col col-lg-1">{{'table_update_id'|bkTranslate:this}}</th>
                            <th class="col col-lg-2">{{'table_created'|bkTranslate:this}}</th>
                            <th class="col col-lg-2">{{'table_planed'|bkTranslate:this}}</th>
                            <th class="col col-lg-2">{{'table_finished'|bkTranslate:this}}</th>
                            <th class="col col-lg-2">{{'table_firmware_type'|bkTranslate:this}}</th>
                            <th class="col col-lg-2">{{'table_update_type'|bkTranslate:this}}</th>
                            <th class="col col-lg-1 text-center">{{'table_update_progress'|bkTranslate:this}}</th>
                            <th class="col col-lg-2 text-center">{{'table_update_state'|bkTranslate:this}}</th>
                            <th class="col col-lg-2 text-center">{{'table_actions'|bkTranslate:this}}</th>
                        </tr>
                    </thead>
                    <tbody>

                        <tr *ngFor="let procedure of actualizationList.content">

                            <td><a (click)="onProcedureClick(procedure)">{{procedure.id.substr(0,13)}}</a></td>
                            <td>{{procedure.date_of_create|bkUnixTimeToDate}}</td>
                            <td>{{procedure.date_of_planing|bkUnixTimeToDate}}</td>
                            <td>
                                <span *ngIf="procedure.date_of_finish == null" class="font-yellow-casablanca">{{'label_time_missing_in_json'|bkTranslate:this}}</span>
                                <span *ngIf="procedure.date_of_finish != null">{{procedure.date_of_finish|bkUnixTimeToDate}}</span>
                            </td>
                            <td>{{procedure.firmware_type|bkTranslateTable:this:'firmware_type'}}</td>
                            <td>{{procedure.type_of_update|bkTranslateTable:this:'type_of_update'}}</td>
                            <td class="text-center">
                                <span *ngIf="procedure.procedure_size_all > 0" class="bold">{{procedure.procedure_size_complete}}/{{procedure.procedure_size_all}}</span>
                                <span *ngIf="!procedure.procedure_size_all ||procedure_size_all == 0 " class="bold">-/-</span>
                            </td>
                            <td class="text-center">
                                <span [innerHTML]="procedure.state|bkTranslateTable:this:'update_status'"></span>
                            </td>
                            <td class="vert-align no-wrap">
                                <style type="text/css">
                                    table tr button {
                                        opacity: 0.05;
                                    }

                                    table tr:hover button {
                                        opacity: 1
                                    }
                                </style>
                                <button title="{{'label_change_update_parameters'|bkTranslate:this}}" class="btn btn-icon-only blue"
                                        [disabled]="!procedure.edit_permission"
                                        (click)="onUpdateProcedureUpdateClick(procedure)">
                                    <i class="fa fa-cog"></i>
                                </button>
                                <button title="{{'label_cancel_update'|bkTranslate:this}}" class="btn btn-icon-only red"
                                        [disabled]="!procedure.edit_permission"
                                        (click)="onUpdateProcedureCancelClick(procedure)">
                                    <i class="fa fa-trash"></i>
                                </button>,

                            </td>

                        </tr>
                    </tbody>
                </table>
            </div>
            <h3 *ngIf="!actualizationList" class="text-center">{{'label_loading'|bkTranslate:this}}</h3>
            <div *ngIf="actualizationList && actualizationList.content.length == 0" class="list-no-items">
                <p class="list-no-items__main-label"><span [innerHTML]="'label_no_updates'|bkTranslate:this"></span></p>
                <p class="list-no-items__sub-label"><span [innerHTML]="'label_no_updates_comment'|bkTranslate:this"></span></p>
                <p>
                    <button class="btn blue" (click)="onProcedureCreateClick()">
                        <i class="fa fa-plus-circle"></i> {{'btn_add_new_update'|bkTranslate:this}}
                    </button>
                </p>
            </div>
        </div>

    </div>

</bk-layout-main>
