<!--
  ~ Â© 2015-2016 Becki Authors. See the AUTHORS file found in the top-level
  ~ directory of this distribution.
  -->

<bk-layout-main tabMenu="projects-project" [title]="currentParamsService.currentProjectNameSnapshot" [subtitle]="currentParamsService.currentProjectDescriptionSnapshot">

    <div class="row">
        <div class="col-md-12">
            <div class="portlet portlet light bordered">
                <div class="portlet-title">
                    <div class="becki-caption">
                        <span class="font-blue-dark uppercase">
                            <i class="fa fa-fw fa-cloud"></i>
                            Instance <strong>{{instance?instance.blocko_instance_name:""}}</strong>
                        </span>
                    </div>
                    <span class="pull-right">

                        <button *ngIf="instance && instance.server_is_online" title="Remove device" class="btn btn-icon-only red"  (click)="onRemoveClick(device)">
                            <i class="fa fa-power-off"></i>
                        </button>

                    </span>
                </div>
                <div>
                    <div *ngIf="instance">
                        <div>
                            <div>
                                Blocko program:
                                <span class="font-grey-mint bold"><a (click)="onBlockoProgramClick(instance.b_program_id)">{{instance.b_program_name}}</a></span>
                            </div>

                            <div *ngIf="instance.b_program_description && instance.b_program_description.length">
                                Description:
                                <span class="font-grey-mint bold">{{instance.b_program_description}}</span>
                            </div>

                            <div>
                                version:
                                <span class="font-grey-mint bold"><a (click)="onBlockoProgramVersionClick(instance)">{{instance.actual_instance.b_program_version_name}}</a></span>
                            </div>

                            <div>
                                Server name:
                                <span class="font-grey-mint bold">{{instance.server_name}}</span><span [class.font-green-jungle]="instance.server_is_online" [class.font-red]="!instance.server_is_online" style="font-size: 1em">&nbsp;(<strong>{{instance.server_is_online?'online':'offline'}}</strong>)</span>
                            </div>


                        </div>

                        <div class="row">
                            

                            <!--div class="col-md-8">
                                Description:
                                <span class="font-grey-mint bold">{{instance.actual_instance.b_program_version_description}}</span>
                                <span *ngIf="!instance.actual_instance.b_program_version_description" class="font-grey-mint bold">No description</span>
                            </div-->
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <div class="col-md-12">
            <div *ngIf="instance" class="portlet portlet light bordered">
                <div class="portlet-title tabbable-line">
                    <div class="becki-caption">
                        <span class="font-blue-dark uppercase">
                            <i class="fa fa-fw fa-list-ul"></i>
                            Info
                        </span>
                    </div>
                    <ul class="nav nav-tabs margin-left-15 pull-left">
                        <li [class.active]="instanceTab == 'schema'">
                            <a class="cursor-pointer" (click)="onToggleinstanceTab('schema')">Schema </a>
                        </li>
                        <li [class.active]="instanceTab == 'history'">
                            <a class="cursor-pointer" (click)="onToggleinstanceTab('history')">History </a>
                        </li>
                        <li [class.active]="instanceTab == 'update'">
                            <a class="cursor-pointer" (click)="onToggleinstanceTab('update')">Update progres </a>
                        </li>
                        <li [class.active]="instanceTab == 'view'">
                            <a class="cursor-pointer" (click)="onToggleinstanceTab('view')">Real-time View </a>
                        </li>
                        <!--<li [class.active]="instanceTab == 'logs'">
                            <a class="cursor-pointer" (click)="onToggleinstanceTab('logs')">Logs </a>
                        </li>-->
                        <!--<li [class.active]="instanceTab == 'debug'">
                            <a class="cursor-pointer" (click)="onToggleinstanceTab('debug')">Debug tools </a>
                        </li>-->
                    </ul>
                </div>

                <div *ngIf="instanceTab == 'schema'">
                    <div class="row">
                        <div class="col-sm-6">
                            <h3>Hardware</h3>
                            <div *ngFor="let hardware of instance.actual_instance.hardware_group" style="margin-bottom: 20px;background: #EEE;padding: 10px;border: 1px solid #1BA39C !important;">
                                <div>
                                    <a (click)="onHardwareClick(hardware.main_board_pair.board_id)" style="margin-bottom: 3px;display: block !important;" class="font-grey-mint">
                                        <strong><span style="font-size:1.2em;">{{hardware.main_board_pair.board_personal_description?(hardware.main_board_pair.board_personal_description+' '):('')}}</span></strong>
                                        <span style="font-size:0.9em;">({{hardware.main_board_pair.board_id}})</span>
                                    </a>
                                </div>
                                <div>Device type: <strong><a class="font-grey-mint" (click)="onBoardTypeClick(hardware.main_board_pair.type_of_board_id)">{{hardware.main_board_pair.type_of_board_id}}</a></strong></div>
                                <div>
                                    Program: <strong><a class="font-grey-mint" (click)="onCProgramClick(hardware.main_board_pair.c_program_id)">{{hardware.main_board_pair.c_program_name}}</a></strong>
                                    <template [ngIf]="hardware.main_board_pair.c_program_description && hardware.main_board_pair.c_program_description.length">
                                        <span>&nbsp;-&nbsp;{{hardware.main_board_pair.c_program_description}}</span>
                                    </template>
                                </div>
                                <div>
                                    Version: <strong><a class="font-grey-mint" (click)="onCProgramVersionClick(hardware.main_board_pair.c_program_id, hardware.main_board_pair.c_program_version_id)">{{hardware.main_board_pair.c_program_version_name}}</a></strong>
                                    <template [ngIf]="hardware.main_board_pair.c_program_version_description && hardware.main_board_pair.c_program_version_description.length">
                                        <span>&nbsp;-&nbsp;{{hardware.main_board_pair.c_program_version_description}}</span>
                                    </template>
                                </div>
                                <div style="margin-left: 10px; margin-top: 10px;" *ngFor="let slave of hardware.device_board_pairs">
                                    <div>
                                        <a (click)="onHardwareClick(slave.board_id)" class="font-grey-mint" style="margin-bottom: 3px;display: block !important;margin-top: 20px;">
                                            <strong><span style="font-size:1.2em;">{{slave.board_personal_description?(slave.board_personal_description+' '):('')}}</span></strong>
                                            <span style="font-size:0.9em;">({{slave.board_id}})</span>
                                        </a>
                                    </div>
                                    <div>Device type: <strong><a class="font-grey-mint" (click)="onBoardTypeClick(slave.type_of_board_id)">{{slave.type_of_board_id}}</a></strong></div>
                                    <div>
                                        Program: <strong><a class="font-grey-mint" (click)="onCProgramClick(slave.c_program_id)">{{slave.c_program_name}}</a></strong>
                                        <template [ngIf]="slave.c_program_description && slave.c_program_description.length">
                                            <span>&nbsp;-&nbsp;{{slave.c_program_description}}</span>
                                        </template>
                                    </div>
                                    <div>
                                        Version: <strong><a class="font-grey-mint" (click)="onCProgramVersionClick(slave.c_program_id, slave.c_program_version_id)">{{slave.c_program_version_name}}</a></strong>
                                        <template [ngIf]="slave.c_program_version_description && slave.c_program_version_description.length">
                                            <span>&nbsp;-&nbsp;{{slave.c_program_version_description}}</span>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            <h4 *ngIf="instance.actual_instance.hardware_group && !instance.actual_instance.hardware_group.length">No Hardware projects in this instance</h4>
                        </div>
                        <div class="col-6">
                            <div *ngIf="instance.actual_instance.m_project_snapshot" class="col-sm-6">
                                <h3>Grid</h3>
                                <div *ngFor="let grid of instance.actual_instance.m_project_snapshot" style="margin-bottom: 20px;background: #EEE;padding: 10px;border: 1px solid #8E44AD !important;">
                                    <div>
                                        <a (click)="onGridProjectClick(grid.m_project_id)" class="font-grey-mint">
                                            <strong><span style="font-size:1.2em;">{{grid.m_project_name}}</span></strong>
                                        </a>
                                    </div>
                                    <template [ngIf]="grid.m_project_description && grid.m_project_description.length">
                                        <div style="font-size:0.9em; color:#888;">{{grid.m_project_description}}</div>
                                    </template> 
                                    <hr style="margin: 0;border-bottom: 1px solid #DDD;margin-top: 10px;">
                                    <div style="margin-left: 10px; margin-top: 10px;" *ngFor="let gridProgram of grid.m_program_snapshots">
                                        <div>
                                            <a class="font-grey-mint" (click)="onGridProgramClick(grid.m_project_id,gridProgram.m_program_id)" class="font-grey-mint">
                                                <strong><span style="font-size:1.0em;">{{gridProgram.m_program_name}}</span></strong>
                                            </a>
                                        </div>
                                        <template [ngIf]="gridProgram.m_program_description && gridProgram.m_program_description.length">
                                            <div style="font-size:0.9em; color:#888;">{{gridProgram.m_program_description}}</div>
                                        </template> 

                                        <div>
                                            Version: <strong><a class="font-grey-mint" (click)="onGridProgramVersionClick(grid.m_project_id, gridProgram.m_program_id, gridProgram.version_object_id)">{{gridProgram.version_object_name}}</a></strong>
                                            <template [ngIf]="gridProgram.version_object_description && gridProgram.version_object_description.length">
                                                <span>&nbsp;-&nbsp;{{gridProgram.version_object_description}}</span>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                                <h4 *ngIf="instance.actual_instance.m_project_snapshot && !instance.actual_instance.m_project_snapshot.length">No Grid projects in this instance</h4>
                            </div>
                        </div>
                    </div>
                </div>


                <div *ngIf="instanceTab == 'history'">
                    <br>
                    <div *ngIf="instance && instance.instance_history && instance.instance_history.length > 1" class="cd-horizontal-timeline mt-timeline-horizontal loaded">
                        <bk-instance-timeline [data]="instance.instance_history.concat().reverse()" (onSelect)="selectedHistoryItem($event)"></bk-instance-timeline>
                    </div>
                    <div *ngIf="!currentHistoricInstance" style="text-align: center;">
                        <div><i class="fa fa-chevron-up"></i></div>
                        <h3 style="margin-top: 10px">Select version for see details</h3>
                    </div>
                    <div class="becki-caption row" *ngIf="currentHistoricInstance">
                        <span class="font-blue-dark uppercase">
                            <h3> <i class="fa fa-fw fa-hdd-o"></i> {{currentHistoricInstance.b_program_version_name}} </h3>
                        </span>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="col-6" *ngIf="currentHistoricInstance" >
                                <div class="col-sm-6">
                                    <h3>Hardware</h3>
                                    <div *ngFor="let hardware of currentHistoricInstance.hardware_group" style="margin-bottom: 20px;background: #EEE;padding: 10px;border: 1px solid #1BA39C !important;">
                                        <div>
                                            <a (click)="onHardwareClick(hardware.main_board_pair.board_id)" style="margin-bottom: 3px;display: block !important;" class="font-grey-mint">
                                                <strong><span style="font-size:1.2em;">{{hardware.main_board_pair.board_personal_description?(hardware.main_board_pair.board_personal_description+' '):('')}}</span></strong>
                                                <span style="font-size:0.9em;">({{hardware.main_board_pair.board_id}})</span>
                                            </a>
                                        </div>
                                        <div>Device type: <strong><a class="font-grey-mint" (click)="onBoardTypeClick(hardware.main_board_pair.type_of_board_id)">{{hardware.main_board_pair.type_of_board_id}}</a></strong></div>
                                        <div>
                                            Program: <strong><a class="font-grey-mint" (click)="onCProgramClick(hardware.main_board_pair.c_program_id)">{{hardware.main_board_pair.c_program_name}}</a></strong>
                                            <template [ngIf]="hardware.main_board_pair.c_program_description && hardware.main_board_pair.c_program_description.length">
                                                <span>&nbsp;-&nbsp;{{hardware.main_board_pair.c_program_description}}</span>
                                            </template>
                                        </div>
                                        <div>
                                            Version: <strong><a class="font-grey-mint" (click)="onCProgramVersionClick(hardware.main_board_pair.c_program_id, hardware.main_board_pair.c_program_version_id)">{{hardware.main_board_pair.c_program_version_name}}</a></strong>
                                            <template [ngIf]="hardware.main_board_pair.c_program_version_description && hardware.main_board_pair.c_program_version_description.length">
                                                <span>&nbsp;-&nbsp;{{hardware.main_board_pair.c_program_version_description}}</span>
                                            </template>
                                        </div>
                                        <div style="margin-left: 10px; margin-top: 10px;" *ngFor="let slave of hardware.device_board_pairs">
                                            <div>
                                                <a (click)="onHardwareClick(slave.board_id)" class="font-grey-mint" style="margin-bottom: 3px;display: block !important;margin-top: 20px;">
                                                    <strong><span style="font-size:1.2em;">{{slave.board_personal_description?(slave.board_personal_description+' '):('')}}</span></strong>
                                                    <span style="font-size:0.9em;">({{slave.board_id}})</span>
                                                </a>
                                            </div>
                                            <div>Device type: <strong><a class="font-grey-mint" (click)="onBoardTypeClick(slave.type_of_board_id)">{{slave.type_of_board_id}}</a></strong></div>
                                            <div>
                                                Program: <strong><a class="font-grey-mint" (click)="onCProgramClick(slave.c_program_id)">{{slave.c_program_name}}</a></strong>
                                                <template [ngIf]="slave.c_program_description && slave.c_program_description.length">
                                                    <span>&nbsp;-&nbsp;{{slave.c_program_description}}</span>
                                                </template>
                                            </div>
                                            <div>
                                                Version: <strong><a class="font-grey-mint" (click)="onCProgramVersionClick(slave.c_program_id, slave.c_program_version_id)">{{slave.c_program_version_name}}</a></strong>
                                                <template [ngIf]="slave.c_program_version_description && slave.c_program_version_description.length">
                                                    <span>&nbsp;-&nbsp;{{slave.c_program_version_description}}</span>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                    <h4 *ngIf="currentHistoricInstance.hardware_group && !currentHistoricInstance.hardware_group.length">No Hardware projects in this instance</h4>
                                </div>
                                <div class="col-sm-6">
                                    <h3>Grid</h3>
                                    <div *ngFor="let grid of currentHistoricInstance.m_project_snapshot" style="margin-bottom: 20px;background: #EEE;padding: 10px;border: 1px solid #8E44AD !important;">
                                        <div>
                                            <a (click)="onGridProjectClick(grid.m_project_id)" class="font-grey-mint">
                                                <strong><span style="font-size:1.2em;">{{grid.m_project_name}}</span></strong>
                                            </a>
                                        </div>
                                        <template [ngIf]="grid.m_project_description && grid.m_project_description.length">
                                            <div style="font-size:0.9em; color:#888;">{{grid.m_project_description}}</div>
                                        </template> 
                                        <hr style="margin: 0;border-bottom: 1px solid #DDD;margin-top: 10px;">
                                        <div style="margin-left: 10px; margin-top: 10px;" *ngFor="let gridProgram of grid.m_program_snapshots">
                                            <div>
                                                <a class="font-grey-mint" (click)="onGridProgramClick(grid.m_project_id,gridProgram.m_program_id)" class="font-grey-mint">
                                                    <strong><span style="font-size:1.0em;">{{gridProgram.m_program_name}}</span></strong>
                                                </a>
                                            </div>
                                            <template [ngIf]="gridProgram.m_program_description && gridProgram.m_program_description.length">
                                                <div style="font-size:0.9em; color:#888;">{{gridProgram.m_program_description}}</div>
                                            </template> 

                                            <div>
                                                Version: <strong><a class="font-grey-mint" (click)="onGridProgramVersionClick(grid.m_project_id, gridProgram.m_program_id, gridProgram.version_object_id)">{{gridProgram.version_object_name}}</a></strong>
                                                <template [ngIf]="gridProgram.version_object_description && gridProgram.version_object_description.length">
                                                    <span>&nbsp;-&nbsp;{{gridProgram.version_object_description}}</span>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                    <h4 *ngIf="currentHistoricInstance.m_project_snapshot && !currentHistoricInstance.m_project_snapshot.length">No Grid projects in this instance</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div *ngIf="instanceTab == 'update'">
                    <div *ngIf="!(instance && instance.actual_instance && instance.actual_instance.procedures && instance.actual_instance.procedures.length)">
                        <h3 style="text-align: center; margin: 80px;">There is no running updates in this instance</h3>
                    </div>
                    <div *ngIf="instance && instance.actual_instance && instance.actual_instance.procedures && instance.actual_instance.procedures.length">

                        <div *ngFor="let procedure of instance.actual_instance.procedures">
                            <h3 style="margin-bottom:10px;">{{procedure.type_of_update|bkTanslate}}</h3>
                            <!--<div>Created: <strong> {{procedure.date_of_create|bkUnixTimeToDate}}</strong></div>-->
                            <div>Planned: <strong> {{procedure.date_of_planing|bkUnixTimeToDate}}</strong></div>
                            <div>Progress: <strong>{{procedure.state_fraction}}</strong></div>
                            <div class="table-scrollable" *ngIf="procedure.updates.length">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Id</th>
                                            <th>Type</th>
                                            <!--<th>Starting date</th>-->
                                            <!--<th>Required program</th>-->
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let update of procedure.updates">
                                            <td class="font-grey-mint"><a (click)="onHardwareClick(update.board_detail.board_id)">{{update.board_detail.personal_description}}</a></td>
                                            <td class="font-grey-mint"><a (click)="onHardwareClick(update.board_detail.board_id)">{{update.board_detail.board_id}}</a></td>
                                            <td class="font-grey-mint"><a style="white-space:nowrap" (click)="onBoardTypeClick(update.board_detail.type_of_board_id)">{{update.board_detail.type_of_board_name}}</a></td>
                                            <!--<td class="font-grey-mint">{{update.date_of_create|bkUnixTimeToDate}}</td>-->
                                            <!--<td>{{update.date_of_planing|bkUnixTimeToDate}}</td>-->
                                            <!--<td class="font-grey-mint">{{update.firmware_type}}</td>-->
                                            <td class="font-grey-mint">{{update.state}} </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div *ngIf="instanceTab == 'view' && instance && instance.instance_online">
                    <bk-blocko-view [disableExecution]="true" [canConfig]="false" [readonly]="true" [simpleMode]="false" [showBlockNames]="true"></bk-blocko-view>
                    <div style="margin-top: 30px">
                        <bk-console-log maxHeight="400px"></bk-console-log>
                    </div>
                </div>
                <div *ngIf="instanceTab == 'view' && instance && !instance.instance_online">
                    <h3 style="text-align: center; margin: 80px;">This instance is offline</h3>
                </div>

                <div *ngIf="instanceTab == 'logs'">
                    
                </div>

                <div *ngIf="instanceTab == 'debug'">

                </div>

            </div>
        </div>
    </div>



</bk-layout-main>
