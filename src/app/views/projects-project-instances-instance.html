<!--
  ~ Â© 2015-2016 Becki Authors. See the AUTHORS file found in the top-level
  ~ directory of this distribution.
  -->

<bk-layout-main [tabMenu]="'projects-project'"
                [show_title]="false"
                [title]="currentParamsService.currentProjectNameSnapshot"
                [subtitle]="currentParamsService.currentProjectDescriptionSnapshot">

    <!-- Portlet - Basic Title of Panel with Buttons on right side -- START -->
    <bk-portlet-title *ngIf="instance"
                      [title_name]="'title'|bkTranslate:this"
                      [title_object_name]="instance.name?instance.name:instance.id"
                      [title_object_description]="instance.description"
                      [icon]="'fa-cloud'"
                      (onClick)="onPortletClick($event)"
                      [btns]="[
                          {
                              condition: (tab == 'overview'),
                              btn_label_for_person: ('label_instance_properties'|bkTranslate:this),
                              icon: 'fa-cog',
                              colorType: 'EDIT',
                              permission: true,
                              btn_tag: 'edit_Instance'
                          },
                          {
                              condition: (tab == 'overview' && instance.current_snapshot != null && instance.server),
                              btn_label_for_person: ('label_deactivate_instance'|bkTranslate:this),
                              icon: 'fa-plus-circle',
                              colorType: 'DEACTIVE',
                              permission: instance.update_permission,
                              btn_tag: 'deactivate_instance'
                          },
                          {
                              condition: ((tab === 'overview' || tab === 'editor') && instance.snapshots && instance.snapshots.length > 0),
                              btn_label_for_person: ('btn_deploy_snapshot'|bkTranslate:this),
                              icon: 'fa-upload',
                              colorType: 'ACTIVE',
                              permission: instance.update_permission,
                              btn_tag: 'deploy_snapshot'
                          },
                          {
                              condition: (tab == 'editor'),
                              btn_label_for_person: ('btn_save'|bkTranslate:this),
                              icon: 'fa-share',
                              colorType: 'ADD',
                              permission: true,
                              btn_tag: 'save_snapshot'
                          },
                          {
                              condition: (tab == 'editor'),
                              btn_label_for_person: ('btn_save_deploy'|bkTranslate:this),
                              icon: 'fa-share',
                              colorType: 'ADD',
                              permission: true,
                              btn_tag: 'save_deploy_snapshot'
                          },
                          {
                              condition: (tab == 'editor'),
                              btn_label_for_person: ('btn_change_version'|bkTranslate:this),
                              icon: 'fa-cog',
                              colorType: 'EDIT',
                              permission: true,
                              btn_tag: 'change_version'
                          },
                          {
                              condition: (tab == 'api'),
                              btn_label_for_person: ('btn_add_key'|bkTranslate:this),
                              icon: 'fa-plus',
                              colorType: 'CREATE',
                              permission: instance.update_permission,
                              btn_tag: 'add_api_key'
                          },
                           {
                              condition: (tab == 'mesh'),
                              btn_label_for_person: ('btn_add_key'|bkTranslate:this),
                              icon: 'fa-plus',
                              colorType: 'CREATE',
                              permission: instance.update_permission,
                              btn_tag: 'add_mesh_key'
                          }
                    ]"
                      (onTabClick)="onToggleTab($event)"
                      [tab_selected_name]="tab"
                      [tabBtns]="[
                        {
                            tab_name: 'overview',
                            condition: (true),
                            tab_color: 'CLOUD',
                            permission: true,
                            tab_label: ('tab_name_overview'|bkTranslate:this)
                        },
                        {
                            tab_name: 'editor',
                            condition: (true),
                            tab_color: 'CLOUD',
                            permission: instance.update_permission,
                            tab_label: ('tab_name_editor'|bkTranslate:this)
                        },
                        {
                            tab_name: 'hardware',
                            condition: (instance && instance.current_snapshot),
                            tab_color: 'HARDWARE',
                            permission: instance.update_permission,
                            tab_label: ('tab_name_hardware'|bkTranslate:this)
                        },
                        {
                            tab_name: 'grid',
                            condition: (instance && instance.current_snapshot),
                            tab_color: 'GRID',
                            tab_label: ('tab_name_grid'|bkTranslate:this)
                        },
                        {
                            tab_name: 'api',
                            condition: (instance && instance.current_snapshot),
                            tab_color: 'CLOUD',
                            tab_label: ('tab_name_api'|bkTranslate:this)
                        },
                        {
                            tab_name: 'mesh',
                            condition: (instance && instance.current_snapshot),
                            tab_color: 'HARDWARE',
                            tab_label: ('tab_name_mesh'|bkTranslate:this)
                        },
                        {
                            tab_name: 'history',
                            condition: (true),
                            tab_color: 'CLOUD',
                            permission: instance.update_permission,
                            tab_label: ('tab_name_history'|bkTranslate:this)
                        },
                        {
                            tab_name: 'update',
                            condition: (instance && instance.current_snapshot),
                            tab_color: 'HARDWARE',
                            permission: instance.update_permission,
                            tab_label: ('tab_name_update_progress'|bkTranslate:this)
                        },
                        {
                            tab_name: 'view',
                            condition: (instance && instance.current_snapshot),
                            tab_color: 'CLOUD',
                            permission: true,
                            tab_label: ('tab_name_update_view'|bkTranslate:this)
                        },
                        {
                            tab_name: 'logs',
                            condition: (false),
                            tab_color: 'CLOUD',
                            permission: instance.update_permission,
                            tab_label: ('tab_name_logs'|bkTranslate:this)
                        }
                    ]"
    >
    </bk-portlet-title>
    <!-- Portlet - Basic Title of Panel with Buttons on right side --- END -->

    <div class="portlet-body">

        <div *ngIf="tab == 'overview' && instance">

            <div class="row">

                <div class="col-md-6 portlet light">

                    <bk-portlet-title [title_name]="'label_byzance_blocko'|bkTranslate:this"
                                      [icon]="'fa-sitemap fa-rotate-90'">
                    </bk-portlet-title>

                    <div class="portlet-body" style="padding-left: 20px">
                        <br>
                        <div>
                            <div>
                                <span [innerHTML]="'label_b_program_name'|bkTranslate:this"></span>: <a
                                (click)="onBProgramClick(instance.b_program.id)">{{instance.b_program.name}}</a>
                            </div>
                            <div>
                                <span [innerHTML]="'label_b_program_description'|bkTranslate:this"></span>:
                                {{instance.b_program.description}}
                            </div>
                        </div>

                    </div>

                </div>

                <div class="col-md-6">

                    <div class="portlet light margin-bottom-15">
                        <bk-portlet-title [title_name]="'label_byzance_cloud'|bkTranslate:this"
                                          [icon]="'fa-cloud'"
                                          (onClick)="onPortletClick($event)">
                        </bk-portlet-title>
                        <div class="portlet-body margin-left-15 margin-top-15">
                            <div *ngIf="instance.server">
                                <div>
                                    <span [innerHTML]="'label_server_name'|bkTranslate:this"></span>:
                                    <strong>{{instance.server.name}}</strong>
                                </div>
                                <div>
                                    <span [innerHTML]="'label_server_description'|bkTranslate:this"></span>:
                                    {{instance.server.description}}
                                </div>

                                <br>
                                <div>
                                    <span [innerHTML]="'label_instance_status'|bkTranslate:this"></span>:
                                    <bk-online-state [online_state]="instance.server.online_state"></bk-online-state>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="portlet light">
                        <bk-portlet-title [title_name]="'label_byzance_instance'|bkTranslate:this"
                                          [icon]="'fa-cloud'"
                                          (onClick)="onPortletClick($event)">
                        </bk-portlet-title>
                        <div class="portlet-body margin-left-15 margin-top-15">
                            <div *ngIf="instance.current_snapshot">
                                <div>
                                    <span [innerHTML]="'label_instance_version_name'|bkTranslate:this"></span>:
                                    <strong>{{instance.current_snapshot.name}}</strong>
                                </div>
                                <div>
                                    <span [innerHTML]="'label_instance_version_description'|bkTranslate:this"></span>:
                                    <strong>{{instance.current_snapshot.b_program_version.description}}</strong>
                                </div>
                                <div class="margin-left-15 margin-top-15 margin-bottom-15">
                                    <div>
                                        <span [innerHTML]="'label_b_program_version_name'|bkTranslate:this"></span>: <a
                                        (click)="onBProgramClick(instance.current_snapshot.b_program.id, instance.current_snapshot.b_program_version.id)">{{instance.current_snapshot.b_program_version.name}}</a>
                                    </div>
                                    <div>
                                        <span
                                            [innerHTML]="'label_b_program_version_description'|bkTranslate:this"></span>:
                                        <strong>{{instance.current_snapshot.b_program_version.description}}</strong>
                                    </div>
                                </div>
                                <div>
                                    <span [innerHTML]="'label_created'|bkTranslate:this"></span>:
                                    <strong>{{instance.current_snapshot.created|bkUnixTimeToDate}}</strong>
                                </div>
                                <div>
                                    <span [innerHTML]="'label_deployed'|bkTranslate:this"></span>:
                                    <strong>{{instance.current_snapshot.deployed|bkUnixTimeToDate}}</strong>
                                </div>
                                <br>
                            </div>
                            <div>
                                <span [innerHTML]="'label_instance_status'|bkTranslate:this"></span>:
                                <bk-online-state [online_state]="instance.online_state"></bk-online-state>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div *ngIf="tab == 'update' && instance && instance.current_snapshot">
            <div *ngIf="(instance.current_snapshot && instance.current_snapshot.updates && instance.current_snapshot.updates.length > 0)">
                <table class="table table-hover table-light   table-scrollable table-scrollable-borderless">
                    <thead>
                    <tr>
                        <th class="vert-align">{{'table_update_id'|bkTranslate:this}}</th>
                        <th class="vert-align">{{'table_created'|bkTranslate:this}}</th>
                        <th class="vert-align">{{'table_planed'|bkTranslate:this}}</th>
                        <th class="vert-align">{{'table_finished'|bkTranslate:this}}</th>
                        <th class="vert-align">{{'table_update_progress'|bkTranslate:this}}</th>
                        <th class="vert-align">{{'table_update_state'|bkTranslate:this}}</th>
                        <th class="text-center">{{'table_actions'|bkTranslate:this}}</th>
                    </tr>
                    </thead>
                    <tbody class="hide-bk-drob-down-button">
                    <tr *ngFor="let procedure of instance.current_snapshot.updates">
                        <td class="vert-align">
                            <a class="bold" (click)="onActualizationProcedureClick(procedure.id)">{{procedure.id.substr(0,
                                12)}}</a>
                        </td>
                        <td class="vert-align  text-center ">{{procedure.created|bkUnixTimeToDate}}</td>
                        <td class="vert-align  text-center">{{procedure.planned|bkUnixTimeToDate}}</td>
                        <td class="vert-align  text-center">
                            <span *ngIf="procedure.finished == null" class="font-yellow-casablanca">{{'label_time_missing_in_json'|bkTranslate:this}}</span>
                            <span
                                *ngIf="procedure.finished != null">{{procedure.finished|bkUnixTimeToDate}}</span>
                        </td>
                        <td class="vert-align  text-center">
                            <span *ngIf="procedure.procedure_size_all > 0" class="bold">{{procedure.state_complete}}/{{procedure.procedure_size_all}}</span>
                            <span *ngIf="!procedure.procedure_size_all || procedure_size_all == 0 "
                                  class="bold">-/-</span>
                        </td>

                        <!-- Update State -->
                        <td class="vert-align">
                            <bk-update-state [updateState]="procedure.state"></bk-update-state>
                        </td>

                        <td class="action-btn-col">

                            <bk-drob-down-button
                                [btns_group_name]="('label_settings'|bkTranslate:this)"
                                [btns]="[
                                {
                                    condition: true,
                                    btn_label_for_person: ('label_cancel_update'|bkTranslate:this),
                                    btn_tag: 'cancel_update_procedure',
                                    icon: 'fa-cog',
                                    colorType: 'UPDATE',
                                    permission: (procedure.update_permission)
                                }
                            ]"
                                (onValueChanged)="onDrobDownEmiter($event, procedure)"
                            >
                            </bk-drob-down-button>

                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>


            <!-- Temporary page content if content is being loaded or if there is no content -- START -->
            <bk-nothing-to-show [condition_loading]="(instance.current_snapshot.updates == null)"
                                [condition_empty]="(instance.current_snapshot.updates != null && instance.current_snapshot.updates.length == 0)"
                                [main_message_link]="'label_no_updates'|bkTranslate:this"
                                [main_message_comment_link]="'label_no_updates_comment'|bkTranslate:this"
                                [btn_label]="'btn_add_new_update'|bkTranslate:this"
                                [show_button]="false">
            </bk-nothing-to-show>
            <!-- Temporary page content if content is being loaded or if there is no content -- END -->

        </div>

        <div  *ngIf="tab == 'editor'">
            {{'label_version_name'|bkTranslate:this}}:
            <span *ngIf="bProgramVersion" class="font-grey-mint bold">{{bProgramVersion.name}}</span>

            <div class="portlet light" style="padding: 0 0 0 0;">
                <div class="portlet-body">
                    <bk-blocko-view [id]="'snapshot_editor'"
                                    [full_page]="true"
                                    [disableExecution]="true"
                                    [bindInterfaceEnabled]="true">
                    </bk-blocko-view>
                </div>
            </div>
        </div>

        <div *ngIf="tab == 'hardware' && instance && instance.current_snapshot">


            <!-- List of Integrated HW groups START-->
            <div>
                <h4 [innerHTML]="'label_hardware_groups'|bkTranslate:this"></h4>

                <div *ngIf="(deviceGroupFilter && deviceGroupFilter.content.length > 0)">
                    <table class="table table-hover table-light   table-scrollable table-scrollable-borderless">
                        <thead>
                        <tr>
                            <th class="" [innerHTML]="'table_hardware_group_name'|bkTranslate:this"></th>
                            <th class="" [innerHTML]="'table_description'|bkTranslate:this"></th>
                            <th class="text-center" [innerHTML]="'table_size'|bkTranslate:this"></th>
                            <th class="text-center" [innerHTML]="'label_type'|bkTranslate:this"></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let group of deviceGroupFilter.content">

                            <td class="vert-align no-wrap bold">{{group.name}}</td>
                            <td class="vert-align no-wrap">{{group.description}}</td>
                            <td class="vert-align text-center no-wrap">{{group.size}}</td>
                            <td class="vert-align text-center no-wrap">
                                <div *ngIf="!group.hardware_types">
                                    -
                                </div>
                                <div *ngIf="group.hardware_types">
                                    [
                                    <span *ngFor="let hw_type of group.hardware_types; let last = last">
                                        <a (click)="onHardwareTypeClick(hw_type.id)">{{hw_type.name}}</a>
                                        <span *ngIf="!last">, </span>
                                 </span>
                                    ]
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Temporary page content if content is being loaded or if there is no content -- START -->
                <bk-nothing-to-show [condition_loading]="(deviceGroupFilter == null)"
                                    [condition_empty]="(deviceGroupFilter != null && deviceGroupFilter.content.length == 0)"
                                    [main_message_link]="'label_no_hardware_groups_in_snapshot'|bkTranslate:this"
                                    [main_message_comment_link]="'label_no_hardware_groups_in_snapshot_comment'|bkTranslate:this"
                                    [show_button]="false">
                </bk-nothing-to-show>
                <!-- Temporary page content if content is being loaded or if there is no content -- END -->


            </div>
            <!-- List of Integrated HW groups END-->

            <hr>
            <!-- List of Integrated HW by filter START-->
            <div>


                <h4 [innerHTML]="'label_hardware_in_instance'|bkTranslate:this"></h4>

                <div *ngIf="(devicesFilter && devicesFilter.content && devicesFilter.content.length > 0)">
                    <table class="table table-hover table-light   table-scrollable table-scrollable-borderless">
                        <thead>
                        <tr>
                            <th class="">
                                <a [innerHTML]="'table_hardware_name'|bkTranslate:this"
                                   (click)="formFilterGroup.controls['orderBy'].setValue('NAME'); onFilterHardware()"
                                   [class.bold]="formFilterGroup.controls['orderBy'].value === 'NAME'"></a>
                                <bk-icon-component *ngIf="formFilterGroup.controls['orderBy'].value === 'NAME'"
                                                   [icon]="formFilterGroup.controls['order_schema'].value === 'ASC' ? 'fa-chevron-up' : 'fa-chevron-down'"
                                                   [color]="'font-silver'"
                                                   [color_on]="'font-color-byzance-blue'"
                                                   [condition]="true"
                                                   (onClickEvent)="formFilterGroup.controls['order_schema'].value === 'ASC' ? formFilterGroup.controls['order_schema'].setValue('DESC') : formFilterGroup.controls['order_schema'].setValue('ASC'); onFilterHardware()">
                                </bk-icon-component>
                            </th>
                            <th class="">
                                <a [innerHTML]="'table_hardware_id'|bkTranslate:this"
                                   (click)="formFilterGroup.controls['orderBy'].setValue('ID'); onFilterHardware()"
                                   [class.bold]="formFilterGroup.controls['orderBy'].value === 'ID'"></a>
                                <bk-icon-component *ngIf="formFilterGroup.controls['orderBy'].value === 'ID'"
                                                   [icon]="formFilterGroup.controls['order_schema'].value === 'ASC' ? 'fa-chevron-up' : 'fa-chevron-down'"
                                                   [color]="'font-silver'"
                                                   [color_on]="'font-color-byzance-blue'"
                                                   [condition]="true"
                                                   (onClickEvent)="formFilterGroup.controls['order_schema'].value === 'ASC' ? formFilterGroup.controls['order_schema'].setValue('DESC') : formFilterGroup.controls['order_schema'].setValue('ASC'); onFilterHardware()">
                                </bk-icon-component>
                            </th>
                            <th class="">
                                <a [innerHTML]="'table_hardware_full_id'|bkTranslate:this"
                                   (click)="formFilterGroup.controls['orderBy'].setValue('FULL_ID'); onFilterHardware()"
                                   [class.bold]="formFilterGroup.controls['orderBy'].value === 'FULL_ID'"></a>
                                <bk-icon-component *ngIf="formFilterGroup.controls['orderBy'].value === 'FULL_ID'"
                                                   [icon]="formFilterGroup.controls['order_schema'].value === 'ASC' ? 'fa-chevron-up' : 'fa-chevron-down'"
                                                   [color]="'font-silver'"
                                                   [color_on]="'font-color-byzance-blue'"
                                                   [condition]="true"
                                                   (onClickEvent)="formFilterGroup.controls['order_schema'].value === 'ASC' ? formFilterGroup.controls['order_schema'].setValue('DESC') : formFilterGroup.controls['order_schema'].setValue('ASC'); onFilterHardware()">
                                </bk-icon-component>
                            </th>

                            <th class="" [innerHTML]="'table_description'|bkTranslate:this"></th>
                            <th class="text-center" [innerHTML]="'table_groups'|bkTranslate:this"></th>
                            <th class="text-center" [innerHTML]="'table_project_status'|bkTranslate:this"></th>
                            <th class="text-center" [innerHTML]="'table_status'|bkTranslate:this"></th>
                            <th class="text-center" [innerHTML]="'table_tags'|bkTranslate:this"></th>
                            <th class="text-center" [innerHTML]="'table_actions'|bkTranslate:this"></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let device of devicesFilter.content">

                            <td class="vert-align">

                                <div class="icon-hint-wraper red" *ngIf="device.alert_list && device.alert_list.length > 0">
                                    <i class="fa fa-fw fa-exclamation-triangle font-red-flamingo"></i>
                                    <div class="hint-fixed">
                                    <span class="hint right">
                                         <div *ngFor="let alert of device.alert_list" class="no-wrap">{{alert|bkTranslateTable:this:'device_alerts'}}</div>
                                    </span>
                                    </div>
                                </div>

                                <a (click)="onDeviceClick(device.id)" class="no-wrap">
                                    <strong *ngIf="device.name && device.name != 'null'">{{device.name}}</strong>
                                    <strong *ngIf="!device.name || device.name == 'null'">{{device.full_id}}</strong>
                                </a>

                            </td>
                            <td class="vert-align breakable">{{device.id.substr(0,13)}}..</td>
                            <td class="vert-align no-wrap word-break">{{device.full_id}}</td>
                            <td class="vert-align no-wrap word-break">{{device.description}}</td>
                            <td class="vert-align text-center no-wrap">

                                <div *ngIf="!device.hardware_groups">
                                    -
                                </div>
                                <div *ngIf="device.hardware_groups">
                                    [
                                    <span *ngFor="let group of device.hardware_groups; let last = last">
                                     {{group.name}}<span *ngIf="!last">, </span>
                                </span>
                                    ]
                                </div>

                            </td>

                            <td class="vert-align text-center no-wrap">

                                <div *ngIf="!device.dominant_entity && device.dominant_project_active">
                                    <span *ngIf="device.dominant_project_active.id">Active In: <a (click)="onProjectClick(device.dominant_project_active.id)">{{device.dominant_project_active.name}}</a></span>
                                    <span *ngIf="!device.dominant_project_active.id" [innerHTML]="'label_foreign_project'|bkTranslate:this"></span>
                                </div>
                                <div *ngIf="!device.dominant_entity && !device.dominant_project_active">
                                    <span class="font-green-jungle">Can Be Activated</span>
                                </div>
                            </td>
                            <td class="vert-align text-center no-wrap">
                                <bk-online-state [online_state]="device.online_state" [latest_online]="device.latest_online"></bk-online-state>
                            </td>

                            <td class="vert-align">
                                <bk-form-tag-input [tags_without_form]="device.tags" [readonly]="true"></bk-form-tag-input>
                            </td>

                            <td class="action-btn-col">

                                <bk-icon-component [condition]="device.online_state=='ONLINE'" [icon]="'fa-lightbulb-o'" [color]="'font-silver'" [color_on]="'font-color-byzance-blue'" (onClickEvent)="onBlinkDeviceClick(device)">
                                </bk-icon-component>

                                <bk-drob-down-button
                                    [btns_group_name]="('label_settings'|bkTranslate:this)"
                                    [btns]="[
                                {
                                    condition: true,
                                    btn_label_for_person: ('label_set_hardware_group'|bkTranslate:this),
                                    btn_tag: 'edit_hardware_group_device',
                                    icon: 'fa-object-group',
                                    colorType: 'UPDATE',
                                    permission: (device.update_permission)
                                },
                                {
                                    condition: (device.online_state === 'ONLINE'),
                                    btn_label_for_person: ('label_blink_hardware'|bkTranslate:this),
                                    btn_tag: 'blink_hardware',
                                    icon: 'fa-lightbulb-o',
                                    colorType: 'ADD',
                                    permission: (device.update_permission)
                                },
                                {
                                    condition: true,
                                    btn_label_for_person: ('label_device_properties'|bkTranslate:this),
                                    btn_tag: 'edit_hardware',
                                    icon: 'fa-cog',
                                    colorType: 'EDIT',
                                    permission: (device.update_permission)
                                },
                                {
                                    condition: (!device.dominant_entity && !device.dominant_project_active),
                                    btn_label_for_person: ('label_activate_hardware'|bkTranslate:this),
                                    btn_tag: 'activate_hardware',
                                    icon: 'fa-flag',
                                    colorType: 'ADD',
                                    permission: (device.update_permission)
                                },
                                {
                                    condition: (device.dominant_entity),
                                    btn_label_for_person: ('label_deactivate_hardware'|bkTranslate:this),
                                    btn_tag: 'deactivate_hardware',
                                    icon: 'fa-ban',
                                    colorType: 'ADD',
                                    permission: (device.update_permission)
                                },
                                {
                                    condition: true,
                                    btn_label_for_person: ('label_remove_device'|bkTranslate:this),
                                    btn_tag: 'remove_hardware',
                                    icon: 'fa-trash',
                                    colorType: 'REMOVE',
                                    permission: (device.delete_permission)
                                }
                            ]"
                                    (onValueChanged)="onDrobDownEmiter($event, device)"
                                >
                                </bk-drob-down-button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <bk-filter-page-component [from]="devicesFilter.from" [to]="devicesFilter.to"
                                              [total]="devicesFilter.total" [totalPages]="devicesFilter.pages"
                                              (onSelect)="onFilterHardware($event)"></bk-filter-page-component>
                </div>

                <!-- Temporary page content if content is being loaded or if there is no content -- START -->
                <bk-nothing-to-show [condition_loading]="(devicesFilter == null || deviceGroupFilter == null)"
                                    [condition_empty]="(devicesFilter != null && devicesFilter.content.length == 0)"
                                    [main_message_link]="'label_no_hardware_in_snapshot'|bkTranslate:this"
                                    [main_message_comment_link]="'label_no_hardware_in_snapshot_comment'|bkTranslate:this"
                                    [show_button]="false">
                </bk-nothing-to-show>
                <!-- Temporary page content if content is being loaded or if there is no content -- END -->
            </div>

        </div>

        <div *ngIf="tab == 'view' && instance && instance.current_snapshot">

            <div *ngIf="instance && instance.online_state === 'ONLINE'">

                <bk-blocko-view [id]="'liveview'" [full_page]="true" [disableExecution]="true" [readonly]="true"></bk-blocko-view>

                <div style="margin-top: 30px">
                    <bk-console-log maxHeight="400px"></bk-console-log>
                </div>

            </div>
            <div *ngIf="!instance || instance.online_state !== 'ONLINE'" class="list-no-items">
                <p class="list-no-items__main-label"
                   [innerHTML]="'label_instance_info_is_offline'|bkTranslate:this"></p>
                <p class="list-no-items__sub-label"
                   [innerHTML]="'label_instance_info_is_offline_comments'|bkTranslate:this"></p>
            </div>

        </div>

        <div *ngIf="tab == 'grid' && instance && instance.current_snapshot">

            <div *ngIf="(instance.current_snapshot.m_projects && instance.current_snapshot.m_projects.length > 0)">

                <div *ngFor="let m_project of instance.current_snapshot.m_projects; let last = last" class="portlet portlet light">

                    <bk-portlet-title
                        [title_name]="'label_grid_project'|bkTranslate:this"
                        [title_object_name]="m_project.grid_project.name"
                        [title_object_description]="m_project.grid_project.description"
                        [icon]="'fa-cube'">
                    </bk-portlet-title>

                    <div class="portlet-body " [class.margin-left-30]="instance.current_snapshot.m_projects.length > 1">
                        <table class="table table-hover table-light  ">
                            <thead>
                            <tr>
                                <th class="" [innerHTML]="'table_grid_program_name'|bkTranslate:this"></th>
                                <th class="" [innerHTML]="'table_grid_program_description'|bkTranslate:this"></th>
                                <th class="" [innerHTML]="'table_grid_program_version_name'|bkTranslate:this"></th>
                                <th class=""
                                    [innerHTML]="'table_grid_program_version_description'|bkTranslate:this"></th>
                                <th class="text-center"
                                    [innerHTML]="'table_grid_program_settings'|bkTranslate:this"></th>
                                <th class="text-center" [innerHTML]="'table_grid_link'|bkTranslate:this"></th>
                                <th class="text-center">{{'table_actions'|bkTranslate:this}}</th>
                            </tr>
                            </thead>
                            <tbody class="hide-bk-drob-down-button">
                            <tr *ngFor="let program of m_project.grid_programs">

                                <td class="vert-align no-wrap"><a
                                    (click)="onGridProgramClick(m_project.grid_project.id, program.grid_program.id)">{{program.grid_program.name}}</a>
                                </td>
                                <td class="vert-align">{{program.grid_program.description}}</td>
                                <td class="vert-align no-wrap"><a
                                    (click)="onGridProgramVersionClick(m_project.grid_project.id, program.grid_program.id, program.grid_program_version.id)">{{program.grid_program_version.name}}</a>
                                </td>
                                <td class="vert-align">{{program.grid_program_version.description}}</td>

                                <td class="vert-align text-center no-wrap">
                                    {{getGridConfig(m_project.grid_project.id,
                                    program.grid_program.id).snapshot_settings}}
                                </td>
                                <td class="vert-align text-center">
                                    <a target="_blank"
                                       href="{{getGridConfig(m_project.grid_project.id, program.grid_program.id).connection_url}}">{{getGridConfig(m_project.grid_project.id,
                                        program.grid_program.id).connection_url}}</a>
                                    <a class="bold margin-left-15 no-wrap" target="_blank"
                                       (click)="showGrid(m_project.grid_project.id, program.grid_program.id)">(Show
                                        QR)</a>
                                </td>

                                <td class="action-btn-col">

                                    <bk-drob-down-button
                                        [btns_group_name]="('label_settings'|bkTranslate:this)"
                                        [btns]="[
                                            {
                                                condition: true,
                                                btn_label_for_person: ('label_edit_grid_app'|bkTranslate:this),
                                                btn_tag: 'edit_grid_app',
                                                icon: 'fa-cogs',
                                                colorType: 'EDIT',
                                                permission: (program.update_permission)
                                            }
                                        ]"
                                        (onValueChanged)="onDropDownEmitterProgram($event, m_project, program)"
                                    >
                                    </bk-drob-down-button>

                                </td>

                            </tr>
                            </tbody>
                        </table>
                        <div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Temporary page content if content is being loaded or if there is no content -- START -->
            <bk-nothing-to-show [condition_loading]="(instance.current_snapshot.m_projects == null)"
                                [condition_empty]="(instance.current_snapshot.m_projects != null && instance.current_snapshot.m_projects.length == 0)"
                                [main_message_link]="'label_grid_group_in_snapshot'|bkTranslate:this"
                                [main_message_comment_link]="'label_no_grid_group_in_snapshot_comment'|bkTranslate:this"
                                [show_button]="false">
            </bk-nothing-to-show>
            <!-- Temporary page content if content is being loaded or if there is no content -- END -->

        </div>

        <div *ngIf="tab == 'logs'">
        </div>

        <div *ngIf="tab == 'debug'">
        </div>

        <div *ngIf="tab == 'api' && instance">
            <div>
                <div *ngIf="(instance.current_snapshot && instance.current_snapshot.settings.api_keys.length)">
                    <table class="table table-hover table-light   table-scrollable table-scrollable-borderless">
                        <thead>
                        <tr>
                            <th [innerHTML]="'table_api_key'|bkTranslate:this"></th>
                            <th [innerHTML]="'table_description'|bkTranslate:this"></th>
                            <th class="text-center">{{'table_actions'|bkTranslate:this}}</th>
                        </tr>
                        </thead>
                        <tbody class="hide-bk-drob-down-button">
                        <tr *ngFor="let key of instance.current_snapshot.settings.api_keys">
                            <td class="vert-align bold">{{key.token}}</td>
                            <td class="vert-align bold">{{key.description}}</td>
                            <td class="action-btn-col">
                                <bk-drob-down-button
                                    [btns_group_name]="('label_settings'|bkTranslate:this)"
                                    [btns]="[
                                       {
                                           condition: true,
                                           btn_label_for_person: ('btn_edit_token'|bkTranslate:this),
                                           btn_tag: 'edit_api_token',
                                           icon: 'fa-cog',
                                           colorType: 'EDIT',
                                           permission: (instance.update_permission)
                                       },
                                       {
                                           condition: true,
                                           btn_label_for_person: ('btn_remove_token'|bkTranslate:this),
                                           btn_tag: 'remove_api_token',
                                           icon: 'fa-trash',
                                           colorType: 'REMOVE',
                                           permission: (instance.delete_permission)
                                       }
                                   ]"
                                    (onValueChanged)="onDrobDownEmiter($event, key)">
                                </bk-drob-down-button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Temporary page content if content is being loaded or if there is no content -- START -->
                <bk-nothing-to-show [condition_loading]="(instance.current_snapshot == null)"
                                    [condition_empty]="(instance.current_snapshot.settings != null && instance.current_snapshot.settings.api_keys.length == 0)"
                                    [main_message_link]="'label_no_api_keys'|bkTranslate:this"
                                    [main_message_comment_link]="'label_no_api_keys_comment'|bkTranslate:this"
                                    [btn_label]="'btn_add_key'|bkTranslate:this"
                                    (onButtonClick)="onPortletClick('add_api_key')">
                </bk-nothing-to-show>
                <!-- Temporary page content if content is being loaded or if there is no content -- END -->

            </div>
            <br>
            <br>
            <hr>
            <br>
            <br>
            <h3>External API to local instance</h3>

            <div *ngIf="(instance && instance.current_snapshot)">
                <table class="table table-hover table-light   table-scrollable table-scrollable-borderless">
                    <thead>
                    <tr>
                        <th class="col" [innerHTML]="'table_name'|bkTranslate:this"></th>
                        <th class="col" [innerHTML]="'table_description'|bkTranslate:this"></th>
                        <th class="col col-lg-6" [innerHTML]="'table_api_url'|bkTranslate:this"></th>
                    </tr>
                    </thead>
                    <tbody class="hide-bk-drob-down-button">
                    <tr *ngFor="let hook of webHooks">
                        <td class="vert-align">{{hook['name']}}</td>
                        <td class="vert-align">{{hook['description']}}</td>
                        <td class="vert-align breakable" [innerHTML]="'POST::' + 'https://' + instance.server.server_url + ':' + instance.server.rest_api_port + '/instance/' + instance.id + '/<strong> {API KEY} </strong>/' +  hook['id']"></td>
                    </tr>
                    </tbody>
                </table>
            </div>

        </div>

        <div *ngIf="tab == 'mesh' && instance">
            <div *ngIf="(instance.current_snapshot)">
                <table class="table table-hover table-light   table-scrollable table-scrollable-borderless">
                    <thead>
                    <tr>
                        <th [innerHTML]="'table_mesh_key'|bkTranslate:this"></th>
                        <th [innerHTML]="'table_description'|bkTranslate:this"></th>
                        <th class="text-center">{{'table_actions'|bkTranslate:this}}</th>
                    </tr>
                    </thead>
                    <tbody class="hide-bk-drob-down-button">
                    <tr *ngFor="let key of instance.current_snapshot.settings.mesh_keys">
                        <td class="vert-align bold">{{key.token}}</td>
                        <td class="vert-align bold">{{key.description}}</td>
                        <td class="action-btn-col">
                            <bk-drob-down-button
                                [btns_group_name]="('label_settings'|bkTranslate:this)"
                                [btns]="[
                                           {
                                               condition: true,
                                               btn_label_for_person: ('btn_edit_token'|bkTranslate:this),
                                               btn_tag: 'edit_mesh_network_token',
                                               icon: 'fa-cog',
                                               colorType: 'EDIT',
                                               permission: (instance.update_permission)
                                           },
                                           {
                                               condition: true,
                                               btn_label_for_person: ('btn_remove_token'|bkTranslate:this),
                                               btn_tag: 'remove_mesh_network_token',
                                               icon: 'fa-trash',
                                               colorType: 'REMOVE',
                                               permission: (instance.delete_permission)
                                           }
                                   ]"
                                (onValueChanged)="onDrobDownEmiter($event, key)">
                            </bk-drob-down-button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div *ngIf="tab == 'api' && instance">
            <div>
                <div *ngIf="(instance.current_snapshot && instance.current_snapshot.settings.api_keys.length)">
                    <table class="table table-hover table-light   table-scrollable table-scrollable-borderless">
                        <thead>
                        <tr>
                            <th [innerHTML]="'table_api_key'|bkTranslate:this"></th>
                            <th [innerHTML]="'table_description'|bkTranslate:this"></th>
                            <th class="text-center">{{'table_actions'|bkTranslate:this}}</th>
                        </tr>
                        </thead>
                        <tbody class="hide-bk-drob-down-button">
                        <tr *ngFor="let key of instance.current_snapshot.settings.api_keys">
                            <td class="vert-align bold">{{key.token}}</td>
                            <td class="vert-align bold">{{key.description}}</td>
                            <td class="action-btn-col">
                                <bk-drob-down-button
                                    [btns_group_name]="('label_settings'|bkTranslate:this)"
                                    [btns]="[
                                       {
                                           condition: true,
                                           btn_label_for_person: ('btn_edit_token'|bkTranslate:this),
                                           btn_tag: 'edit_api_token',
                                           icon: 'fa-cog',
                                           colorType: 'EDIT',
                                           permission: (instance.update_permission)
                                       },
                                       {
                                           condition: true,
                                           btn_label_for_person: ('btn_remove_token'|bkTranslate:this),
                                           btn_tag: 'remove_api_token',
                                           icon: 'fa-trash',
                                           colorType: 'REMOVE',
                                           permission: (instance.delete_permission)
                                       }
                                   ]"
                                    (onValueChanged)="onDrobDownEmiter($event, key)">
                                </bk-drob-down-button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Temporary page content if content is being loaded or if there is no content -- START -->
                <bk-nothing-to-show [condition_loading]="(instance.current_snapshot == null)"
                                    [condition_empty]="(instance.current_snapshot.settings != null && instance.current_snapshot.settings.api_keys.length == 0)"
                                    [main_message_link]="'label_no_api_keys'|bkTranslate:this"
                                    [main_message_comment_link]="'label_no_api_keys_comment'|bkTranslate:this"
                                    [btn_label]="'btn_add_key'|bkTranslate:this"
                                    (onButtonClick)="onPortletClick('add_api_key')">
                </bk-nothing-to-show>
                <!-- Temporary page content if content is being loaded or if there is no content -- END -->

            </div>
            <br>
            <br>
            <hr>
            <br>
            <br>
            <h3>External API to local instance</h3>

            <div *ngIf="(instance && instance.current_snapshot)">
                <table class="table table-hover table-light   table-scrollable table-scrollable-borderless">
                    <thead>
                    <tr>
                        <th class="col" [innerHTML]="'table_name'|bkTranslate:this"></th>
                        <th class="col" [innerHTML]="'table_description'|bkTranslate:this"></th>
                        <th class="col col-lg-6" [innerHTML]="'table_api_url'|bkTranslate:this"></th>
                    </tr>
                    </thead>
                    <tbody class="hide-bk-drob-down-button">
                    <tr *ngFor="let hook of webHooks">
                        <td class="vert-align">{{hook['name']}}</td>
                        <td class="vert-align">{{hook['description']}}</td>
                        <td class="vert-align" [innerHTML]="'POST::' + 'https://' + instance.server.server_url + ':' + instance.server.rest_api_port + '/instance/' + instance.id + '/<strong> {API KEY} </strong>/' +  hook['id']"></td>
                    </tr>
                    </tbody>
                </table>
            </div>

        </div>

        <div *ngIf="tab == 'mesh' && instance">
            <div *ngIf="(instance.current_snapshot)">
                <table class="table table-hover table-light   table-scrollable table-scrollable-borderless">
                    <thead>
                    <tr>
                        <th [innerHTML]="'table_mesh_key'|bkTranslate:this"></th>
                        <th [innerHTML]="'table_description'|bkTranslate:this"></th>
                        <th class="text-center">{{'table_actions'|bkTranslate:this}}</th>
                    </tr>
                    </thead>
                    <tbody class="hide-bk-drob-down-button">
                    <tr *ngFor="let key of instance.current_snapshot.settings.mesh_keys">
                        <td class="vert-align bold">{{key.token}}</td>
                        <td class="vert-align bold">{{key.description}}</td>
                        <td class="action-btn-col">
                            <bk-drob-down-button
                                [btns_group_name]="('label_settings'|bkTranslate:this)"
                                [btns]="[
                                           {
                                               condition: true,
                                               btn_label_for_person: ('btn_edit_token'|bkTranslate:this),
                                               btn_tag: 'edit_mesh_network_token',
                                               icon: 'fa-cog',
                                               colorType: 'EDIT',
                                               permission: (instance.update_permission)
                                           },
                                           {
                                               condition: true,
                                               btn_label_for_person: ('btn_remove_token'|bkTranslate:this),
                                               btn_tag: 'remove_mesh_network_token',
                                               icon: 'fa-trash',
                                               colorType: 'REMOVE',
                                               permission: (instance.delete_permission)
                                           }
                                   ]"
                                (onValueChanged)="onDrobDownEmiter($event, key)">
                            </bk-drob-down-button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div *ngIf="tab == 'history' && instance">

            <div *ngIf="(instance.snapshots && instance.snapshots.length > 0)">
                <table class="table table-hover table-light   table-scrollable table-scrollable-borderless">
                    <thead>
                    <tr>
                        <th [innerHTML]="'table_name'|bkTranslate:this"></th>
                        <th [innerHTML]="'table_description'|bkTranslate:this"></th>
                        <th class="text-center">{{'table_tags'|bkTranslate:this}}</th>
                        <!-- ChybÃ­ API
                        <th [innerHTML]="'table_b_program_version_name'|bkTranslate:this"></th>
                        <th [innerHTML]="'table_b_program_version_description'|bkTranslate:this"></th>

                        -->
                        <th class="text-center">{{'table_actions'|bkTranslate:this}}</th>
                    </tr>
                    </thead>
                    <tbody class="hide-bk-drob-down-button">
                    <tr *ngFor="let snapshot of instance.snapshots">
                        <td class="vert-align">{{snapshot.name}}
                            <i *ngIf="instance.current_snapshot && snapshot.id === instance.current_snapshot.id"
                               class="fa fa-fw fa-cloud font-color-cloud margin-left-15"></i>
                        </td>
                        <td class="vert-align">{{snapshot.description}}</td>

                        <td class="vert-align text-center">
                            <bk-form-tag-input [tags_without_form]="snapshot.tags" [readonly]="true"></bk-form-tag-input>
                        </td>
                        <!-- ChybÃ­ API
                           <td class="vert-align no-wrap bold">
                               <a (click)="onBProgramClick(snapshot.b_program.id)">{{snapshot.b_program_version.name}}</a>
                           </td>
                           <td class="vert-align">{{snapshot.b_program_version.description}}</td>
                        -->
                       <td class="action-btn-col">

                           <bk-drob-down-button
                               [btns_group_name]="('label_settings'|bkTranslate:this)"
                               [btns]="[
                               {
                                   condition: true,
                                   btn_label_for_person: ('label_snapshot_settings'|bkTranslate:this),
                                   btn_tag: 'edit_snapshot_instance',
                                   icon: 'fa-cog',
                                   colorType: 'EDIT',
                                   permission: (instance.update_permission)
                               },
                               {
                                   condition: true,
                                   btn_label_for_person: ('label_deploy_snapshot'|bkTranslate:this),
                                   btn_tag: 'deploy_selected_snapshot',
                                   icon: 'fa-upload',
                                   colorType: 'ACTIVE',
                                   permission: (instance.update_permission)
                               },
                               {
                                   condition: true,
                                   btn_label_for_person: ('label_snapshot_remove'|bkTranslate:this),
                                   btn_tag: 'remove_instance',
                                   icon: 'fa-trash',
                                   colorType: 'REMOVE',
                                   permission: (instance.delete_permission)
                               }
                           ]"
                               (onValueChanged)="onDrobDownEmiter($event, snapshot)"
                           >
                           </bk-drob-down-button>
                       </td>
                   </tr>
                   </tbody>
               </table>
           </div>

            <!-- Temporary page content if content is being loaded or if there is no content -- START -->
            <bk-nothing-to-show [condition_loading]="(instance.snapshots == null)"
                                [condition_empty]="(instance.snapshots != null && instance.snapshots.length == 0)"
                                [main_message_link]="'label_no_instance_history'|bkTranslate:this"
                                [main_message_comment_link]="'label_no_instance_history_comment'|bkTranslate:this"
                                [btn_label]="'btn_add_new_snapshot'|bkTranslate:this"
                                (onButtonClick)="onToggleTab('editor')">
            </bk-nothing-to-show>
            <!-- Temporary page content if content is being loaded or if there is no content -- END -->


        </div>
    </div>

</bk-layout-main>
