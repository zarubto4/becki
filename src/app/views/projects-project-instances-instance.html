<!--
  ~ Â© 2015-2016 Becki Authors. See the AUTHORS file found in the top-level
  ~ directory of this distribution.
  -->

<bk-layout-main tabMenu="projects-project" [title]="currentParamsService.currentProjectNameSnapshot"
                [subtitle]="currentParamsService.currentProjectDescriptionSnapshot">

    <div *ngIf="instance" class="row">
        <div class="col-md-12">
            <div class="portlet portlet light bordered">
                <div class="portlet-title">
                    <div class="becki-caption">
                        <span class="font-blue-dark">
                          <i class="fa fa-fw fa-cloud"></i>
                          <span [innerHTML]="'title'|bkTranslate:this:instance.name?instance.name:instance.id"></span>
                        </span>
                    </div>
                    <div class="becki-actions">

                        <button title="{{'label_instance_properties'|bkTranslate:this}}"
                                class="btn btn-icon-only blue" [disabled]="!instance.edit_permission"
                                (click)="onInstanceEditClick()">
                            <i class="fa fa-cog"></i>
                        </button>


                        <button *ngIf="instance.online_state == 'shut_down'" class="btn green-jungle" [disabled]="!instance.update_permission"
                                (click)="onInstanceStartOrShutdownClick(true)">
                            <i class="fa fa-code-fork"></i> {{'btn_upload_on_cloud'|bkTranslate:this}}
                        </button>
                        <button *ngIf="instance.online_state == 'offline'" class="btn blue-hoki" [disabled]="!instance.update_permission"
                                (click)="onChangeVersionClick()">
                            <i class="fa fa-code-fork"></i> {{'btn_change_version_in_cloud'|bkTranslate:this}}
                        </button>
                        <button *ngIf="instance.online_state == 'shut_down'"  class="btn blue-hoki" [disabled]="!instance.update_permission"
                                (click)="onChangeVersionClick()">
                            <i class="fa fa-code-fork"></i> {{'btn_select_cloud_version'|bkTranslate:this}}
                        </button>


                        <button *ngIf="instance && instance.online_state == 'online'"
                                title="{{'btn_turn_off_instance'|bkTranslate:this}}" class="btn btn-icon-only red"
                                (click)="onInstanceStartOrShutdownClick(false)">
                            <i class="fa fa-power-off"></i>
                        </button>

                    </div>
                </div>

                <div class="portlet-title tabbable-line">
                    <ul class="nav nav-tabs pull-left">

                        <li [class.active]="instanceTab == 'overview'">
                            <a class="cursor-pointer" (click)="onToggleinstanceTab('overview')">{{'tab_name_overview'|bkTranslate:this}}</a>
                        </li>
                        <li [class.active]="instanceTab == 'hardware'">
                            <a *ngIf="instance && instance.actual_instance" class="cursor-pointer" (click)="onToggleinstanceTab('hardware')"><span [innerHTML]="'tab_name_hardware'|bkTranslate:this"></span></a>
                        </li>
                        <li [class.active]="instanceTab == 'grid'">
                            <a *ngIf="instance && instance.actual_instance" class="cursor-pointer" (click)="onToggleinstanceTab('grid')"><span [innerHTML]="'tab_name_grid'|bkTranslate:this"></span></a>
                        </li>
                        <li [class.active]="instanceTab == 'history'">
                            <a class="cursor-pointer" (click)="onToggleinstanceTab('history')">{{'tab_name_history'|bkTranslate:this}}</a>
                        </li>
                        <li [class.active]="instanceTab == 'update'">
                            <a *ngIf="instance && instance.actual_instance" class="cursor-pointer" (click)="onToggleinstanceTab('update')">{{'tab_name_update_progress'|bkTranslate:this}}</a>
                        </li>
                        <li [class.active]="instanceTab == 'view'">
                            <a *ngIf="instance && instance.actual_instance" class="cursor-pointer" (click)="onToggleinstanceTab('view')">{{'tab_name_update_view'|bkTranslate:this}}</a>
                        </li>
                        <!--<li [class.active]="instanceTab == 'logs'">
                            <a class="cursor-pointer" (click)="onToggleinstanceTab('logs')">Logs </a>
                        </li>-->
                        <!--<li [class.active]="instanceTab == 'debug'">
                            <a class="cursor-pointer" (click)="onToggleinstanceTab('debug')">Debug tools </a>
                        </li>-->
                    </ul>
                </div>

                <div *ngIf="instanceTab == 'overview'" class="margin-left-15 margin-top-40">

                    <div *ngIf="instance" class="row">
                        <h3 *ngIf="instanceStatus">{{instanceStatus.online_status}}</h3>
                        <div class="col-md-8">

                            <div>
                                <strong class="font-color-cloud">{{'label_cloud'|bkTranslate:this}} </strong>{{'label_instance_name'|bkTranslate:this}}:
                                <strong>{{instance.name?instance.name:instance.id}}</strong>
                            </div>
                            <div>
                                <strong class="font-color-cloud">{{'label_cloud'|bkTranslate:this}} </strong>{{'label_instance_description'|bkTranslate:this}}:
                                <strong>{{instance.description}}</strong>
                            </div>
                            <div>
                                <strong class="font-color-cloud">{{'label_cloud'|bkTranslate:this}} </strong>
                                {{'label_instance_id'|bkTranslate:this}}:
                                <strong>{{instance.id}}</strong>
                            </div>

                            <br>

                            <div>
                                <strong class="font-color-cloud">{{'label_cloud'|bkTranslate:this}} </strong>{{'label_server_name'|bkTranslate:this}}:
                                <strong><span>{{instance.server_name}}</span></strong>

                                <span *ngIf="instance.server_online_state =='online'" class="font-green-jungle bold">{{instance.server_online_state|bkTranslateTable:this:'online_status'}}</span>
                                <span *ngIf="instance.server_online_state=='offline'" class="font-red bold"><strong>{{instance.server_online_state|bkTranslateTable:this:'online_status'}}</strong></span>
                                <span *ngIf="instance.server_online_state=='synchronization_in_progress'" class="font-red bold"><i class="fa fa-spinner fa-spin"></i></span>

                            </div>

                            <div>

                                <strong class="font-color-cloud">{{'label_cloud'|bkTranslate:this}} </strong>{{'label_instance_status'|bkTranslate:this}}:

                                <span *ngIf="instance.online_state =='online' " class="font-green-jungle bold">{{instance.online_state|bkTranslateTable:this:'online_status'}}</span>
                                <span *ngIf="instance.online_state =='offline' " class="font-red bold">{{instance.online_state|bkTranslateTable:this:'online_status'}}</span>
                                <span *ngIf="instance.online_state =='synchronization_in_progress' " class="font-grey-mint bold"><i class="fa fa-spinner fa-spin"></i></span>
                                <span *ngIf="instance.online_state =='unknown_lost_connection_with_server' " class="font-grey-mint bold">{{instance.online_state|bkTranslateTable:this:'online_status'}}</span>
                                <span *ngIf="instance.online_state =='shut_down' " class="font-grey-mint bold">{{'label_instance_not_running_in_cloud'|bkTranslate:this}} <span class="font-yellow-casablanca bold">({{instance.online_state|bkTranslateTable:this:'online_status'}})</span></span>

                            </div>

                        </div>

                        <div class="col-md-4">
                            <!-- Place for picture or something else -->
                        </div>

                    </div>

                    <br>
                    <br>
                    <br>
                    <br>


                    <div class="row">

                        <div class="col-md-6">
                            <div class="portlet portlet light bordered">
                                <div class="portlet-title">
                                    <div class="becki-caption">
                                        <span class="font-blue-dark">
                                                    <i class="fa fa-fw fa-code"></i>
                                                    <span [innerHTML]="'label_byzance_blocko'|bkTranslate:this"></span>
                                        </span>
                                    </div>
                                </div>
                                <div>

                                    <div *ngIf="instance && instance.actual_instance">

                                        <div>
                                            <strong
                                                class="font-color-blocko">{{'label_blocko'|bkTranslate:this}} </strong>{{'label_program'|bkTranslate:this}}:
                                            <span class="font-grey-mint bold"><a (click)="onBlockoProgramClick(instance.b_program_id)">{{instance.b_program_name}}</a></span>
                                        </div>

                                        <div
                                            *ngIf="instance.actual_instance.b_program_description && instance.actual_instance.b_program_description.length">
                                            <strong class="font-color-blocko">{{'label_blocko'|bkTranslate:this}} </strong>{{'label_description'|bkTranslate:this}}:
                                            <span class="font-grey-mint bold">{{instance.b_program_description}}</span>
                                        </div>
                                        <br>
                                        <div>
                                            <strong class="font-color-blocko">{{'label_blocko'|bkTranslate:this}} </strong>{{'label_version'|bkTranslate:this}}:
                                            <span class="font-grey-mint bold"><a
                                                (click)="onBlockoProgramVersionClick(instance.actual_instance.b_program_id, instance.actual_instance.b_program_version_id)">{{instance.actual_instance.b_program_version_name}}</a></span>
                                        </div>
                                        <div>
                                            <strong class="font-color-blocko">{{'label_blocko'|bkTranslate:this}} </strong>{{'label_description'|bkTranslate:this}}:
                                            <span class="font-grey-mint bold">{{instance.actual_instance.b_program_version_description}}</span>
                                        </div>
                                    </div>

                                    <div *ngIf="instance && !instance.actual_instance">

                                        <div>
                                            <span class="font-grey-mint">Instance is not running in Cloud. (DopÅeloÅ¾it do Tabulky) </span>
                                        </div>

                                        <br>

                                        <!-- Do budoucna nebude Instance vÃ¡zanÃ¡ na Blocko a tato ÄÃ¡st se smaÅ¾e -->

                                        <div>
                                            <strong class="font-color-blocko">{{'label_blocko'|bkTranslate:this}} </strong>{{'label_program'|bkTranslate:this}}:
                                            <span class="font-grey-mint bold"><a
                                                (click)="onBlockoProgramClick(instance.b_program_id)">{{instance.b_program_name}}</a></span>
                                        </div>

                                        <div *ngIf="instance.b_program_description && instance.b_program_description.length">
                                            <strong class="font-color-blocko">{{'label_blocko'|bkTranslate:this}} </strong>{{'label_description'|bkTranslate:this}}:
                                            <span class="font-grey-mint bold">{{instance.b_program_description}}</span>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="portlet portlet light bordered">
                                <div class="portlet-title">
                                    <div class="becki-caption">
                                <span class="font-blue-dark">
                                             <i class="fa fa-fw fa-cloud"></i>
                                             <span [innerHTML]="'label_byzance_cloud'|bkTranslate:this"></span>
                                </span>
                                    </div>
                                </div>

                                <div>
                                    {{'label_instance_type'|bkTranslate:this}}:
                                    <span class="font-grey-mint bold">{{instance.instance_type|bkTranslateTable:this:'instance_type'}}</span>
                                </div>

                                <br>

                                <div *ngIf="instance.actual_instance!=null">

                                     <div>{{'label_created'|bkTranslate:this}}:
                                       <span class="font-grey-mint bold">{{instance.actual_instance.date_of_created|bkUnixTimeToDate}}</span>
                                     </div>
                                    <div>
                                        {{'label_running_from'|bkTranslate:this}}:
                                        <span
                                            class="font-grey-mint bold">{{instance.actual_instance.running_from|bkUnixTimeToDate}}</span>
                                    </div>
                                    <div>
                                        {{'label_running_status'|bkTranslate:this}}:
                                        <span class="font-grey-mint bold">{{instance.actual_instance.status|bkTranslateTable:'instance_status'}}</span>
                                    </div>

                                 </div>

                                <div *ngIf="instance.actual_instance==null">
                                    <div>
                                       <span class="font-grey-mint">Cloud not contains any running snapshot of this instance.  (DopÅeloÅ¾it do Tabulky) </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div *ngIf="instanceTab == 'grid'">
                    <div class="row">
                        <div *ngIf="instance && instance.actual_instance" class="col-6">
                            <div *ngIf="instance.actual_instance.m_project_snapshot">
                                <div *ngFor="let grid of instance.actual_instance.m_project_snapshot"
                                     style="margin-bottom: 20px;background: #EEE;padding: 0;border: 1px solid #8E44AD !important;">
                                    <div style="margin: 10px;">
                                        <div>
                                            <strong class="font-color-grid">{{'label_grid'|bkTranslate:this}}</strong>{{'label_project'|bkTranslate:this}}:
                                            <a (click)="onGridProjectClick(grid.m_project_id)" class="font-grey-mint">
                                                <strong><span
                                                    style="font-size:1.2em;">{{grid.m_project_name}}</span></strong>
                                            </a>
                                        </div>
                                        <div
                                            [ngIf]="grid.m_project_description && grid.m_project_description.length">
                                            <div style="font-size:0.9em; color:#555;">
                                                {{grid.m_project_description}}
                                            </div>
                                        </div>
                                    </div>
                                    <hr style="margin: 0 10px;border-bottom: 1px solid #DDD;margin-top: 10px;">
                                    <div style="margin-top: 10px;" *ngFor="let gridProgram of grid.m_program_snapshots">

                                        <div style="padding: 10px; padding-left: 20px; position: relative;"
                                             [class.bg-yellow-saffron]="gridProgram.snapshot_settings == 'absolutely_public'"
                                             [class.bg-green-meadow]="gridProgram.snapshot_settings != 'absolutely_public'">
                                            <div>
                                                <strong
                                                    class="font-color-grid">{{'label_grid'|bkTranslate:this}}</strong>{{'label_program'|bkTranslate:this}}:
                                                <a class="font-grey-mint"
                                                   (click)="onGridProgramClick(grid.m_project_id,gridProgram.m_program_id)"
                                                   class="font-grey-mint">
                                                    <strong><span style="font-size:1.0em;">{{gridProgram.m_program_name}}</span></strong>
                                                </a>
                                            </div>
                                            <template [ngIf]="gridProgram.m_program_description && gridProgram.m_program_description.length">
                                                <div style="font-size:0.9em; color:#555;">
                                                    {{gridProgram.m_program_description}}
                                                </div>
                                            </template>
                                            <div>
                                                <strong
                                                    class="font-color-grid">{{'label_grid'|bkTranslate:this}}</strong>{{'label_version'|bkTranslate:this}}:
                                                <strong><a class="font-grey-mint"
                                                           (click)="onGridProgramVersionClick(grid.m_project_id, gridProgram.m_program_id, gridProgram.version_object_id)">{{gridProgram.version_object_name}}</a></strong>
                                                <template
                                                    [ngIf]="gridProgram.version_object_description && gridProgram.version_object_description.length">
                                                    <span>&nbsp;-&nbsp;{{gridProgram.version_object_description}}</span>
                                                </template>
                                            </div>

                                            <div style="position: absolute; right: 10px; top: 10px;">
                                                <span
                                                    [class.font-blue-dark]="gridProgram.snapshot_settings == 'only_for_project_members'">{{'only_for_project_members'|bkTranslateTable:this:'snapshot_settings'}}</span>
                                                <i class="fa cursor-hand"
                                                   style="vertical-align: middle; font-size: 1.5em;"
                                                   [class.fa-toggle-on]="gridProgram.snapshot_settings != 'absolutely_public'"
                                                   [class.fa-toggle-off]="gridProgram.snapshot_settings == 'absolutely_public'"
                                                   (click)="onGridProgramPublishClick(gridProgram)"></i>
                                                <span
                                                    [class.font-blue-dark]="gridProgram.snapshot_settings == 'absolutely_public'">{{'absolutely_public'|bkTranslateTable:this:'snapshot_settings'}}</span>
                                            </div>
                                        </div>
                                        <div style="margin-top: 10px; margin-left: 20px; margin-right: 20px;">
                                            <a target="_blank" href="{{gridProgram.grid_app_url}}">
                                                <bk-qr-code style="float: left;"
                                                            [data]="gridProgram.grid_app_url"></bk-qr-code>
                                            </a>
                                            <div style="clear:both;"></div>
                                        </div>
                                        <div
                                            style="margin-top: 10px; margin-left: 20px; margin-right: 20px; margin-bottom: 10px;">
                                            <input onClick="this.setSelectionRange(0, this.value.length)" type="text"
                                                   style="width: 100%;" value="{{gridProgram.grid_app_url}}"
                                                   readonly="true">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <div
                                *ngIf="instance.actual_instance.m_project_snapshot && !instance.actual_instance.m_project_snapshot.length"
                                class="list-no-items">
                                <p class="list-no-items__main-label"
                                   [innerHTML]="'label_grid_no_grid_in_instance'|bkTranslate:this"></p>
                                <p class="list-no-items__sub-label"
                                   [innerHTML]="'label_grid_no_grid_in_instance_comments'|bkTranslate:this"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div *ngIf="instanceTab == 'hardware'">
                    <div class="row">
                        <div *ngIf="instance && instance.actual_instance" class="col-sm-6">
                            <div *ngFor="let hardware of instance.actual_instance.hardware_group"
                                 style="margin-bottom: 20px;background: #EEE;padding: 10px;border: 1px solid #1BA39C !important;">
                                <div>
                                    <a (click)="onHardwareClick(hardware.main_board_pair.board_id)"
                                       style="margin-bottom: 3px;display: block !important;"
                                       class="font-color-hardware">
                                        <strong><span style="font-size:1.2em;">{{hardware.main_board_pair.board_name?(hardware.main_board_pair.board_name+' '):('')}}</span></strong>
                                        <span
                                            style="font-size:0.9em;">({{hardware.main_board_pair.board_id}})</span>
                                    </a>
                                </div>
                                <template
                                    [ngIf]="hardware.main_board_pair.board_description && hardware.main_board_pair.board_description.length">
                                    <div style="font-size:0.9em; color:#888;">
                                        {{hardware.main_board_pair.board_description}}
                                    </div>
                                </template>
                                <div><strong
                                    class="font-color-hardware">{{'label_hardware_caps'|bkTranslate:this}}</strong>{{'table_hardware_type'|bkTranslate:this}}:
                                    <strong><a
                                        (click)="onBoardTypeClick(hardware.main_board_pair.type_of_board_id)">{{hardware.main_board_pair.type_of_board_name}}</a></strong>
                                </div>
                                <br>
                                <div>
                                    <strong class="font-color-code">{{'label_code'|bkTranslate:this}}</strong>{{'label_program'|bkTranslate:this}}:
                                    <strong><a (click)="onCProgramClick(hardware.main_board_pair.c_program_id)">{{hardware.main_board_pair.c_program_name}}</a></strong>
                                    <template
                                        [ngIf]="hardware.main_board_pair.c_program_description && hardware.main_board_pair.c_program_description.length">
                                        <span>{{hardware.main_board_pair.c_program_description}}</span>
                                    </template>
                                </div>
                                <div>
                                    <strong class="font-color-code">{{'label_code'|bkTranslate:this}}</strong>{{'label_version'|bkTranslate:this}}:
                                    <strong><a
                                        (click)="onCProgramVersionClick(hardware.main_board_pair.c_program_id, hardware.main_board_pair.c_program_version_id)">{{hardware.main_board_pair.c_program_version_name}}</a></strong>
                                    <template
                                        [ngIf]="hardware.main_board_pair.c_program_version_description && hardware.main_board_pair.c_program_version_description.length">
                                        <span>&nbsp;-&nbsp;{{hardware.main_board_pair.c_program_version_description}}</span>
                                    </template>
                                </div>
                                <div style="margin-left: 10px; margin-top: 10px;"
                                     *ngFor="let slave of hardware.device_board_pairs">
                                    <div>
                                        <a (click)="onHardwareClick(slave.board_id)"
                                           style="margin-bottom: 3px;display: block !important;margin-top: 20px;">
                                            <strong><span style="font-size:1.2em;">{{slave.board_name?(slave.board_name+' '):('')}}</span></strong>
                                            <span style="font-size:0.9em;">({{slave.board_id}})</span>
                                        </a>
                                    </div>
                                    <div><strong
                                        class="font-color-hardware">{{'label_hardware_caps'|bkTranslate:this}}</strong>{{'table_hardware_type'|bkTranslate:this}}:
                                        <strong><a (click)="onBoardTypeClick(slave.type_of_board_id)">{{slave.type_of_board_name}}</a></strong>
                                    </div>
                                    <br>
                                    <div>
                                        <strong class="font-color-code">{{'label_code'|bkTranslate:this}}</strong>{{'label_program'|bkTranslate:this}}:
                                        <strong><a (click)="onCProgramClick(slave.c_program_id)">{{slave.c_program_name}}</a></strong>
                                        <template
                                            [ngIf]="slave.c_program_description && slave.c_program_description.length">
                                            <span>{{slave.c_program_description}}</span>
                                        </template>
                                    </div>
                                    <div>
                                        <strong class="font-color-code">{{'label_code'|bkTranslate:this}}</strong>{{'label_version'|bkTranslate:this}}:
                                        <strong><a
                                            (click)="onCProgramVersionClick(slave.c_program_id, slave.c_program_version_id)">{{slave.c_program_version_name}}</a></strong>
                                        <template
                                            [ngIf]="slave.c_program_version_description && slave.c_program_version_description.length">
                                            <span>{{slave.c_program_version_description}}</span>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div
                            *ngIf="instance.actual_instance.hardware_group && !instance.actual_instance.hardware_group.length"
                            class="list-no-items">
                            <p class="list-no-items__main-label"
                               [innerHTML]="'label_hardware_no_hardware_in_instance'|bkTranslate:this"></p>
                            <p class="list-no-items__sub-label"
                               [innerHTML]="'label_hardware_no_hardware_in_instancecomments'|bkTranslate:this"></p>
                        </div>
                    </div>
                </div>

                <div *ngIf="instanceTab == 'history'">

                    <div *ngIf="instance && instance.instance_history.length ">
                        <div class="cd-horizontal-timeline mt-timeline-horizontal loaded">
                            <bk-instance-timeline [data]="instance.instance_history.concat().reverse()"
                                                  (onSelect)="selectedHistoryItem($event)"></bk-instance-timeline>
                        </div>
                        <div *ngIf="!currentHistoricInstance" style="text-align: center;">
                            <div><i class="fa fa-chevron-up"></i></div>
                            <h3 style="margin-top: 10px">
                                {{'label_select_version_for_details'|bkTranslate:this}}</h3>
                        </div>
                    </div>
                    <div *ngIf="instance && !instance.instance_history.length" class="list-no-items">
                        <p class="list-no-items__main-label"
                           [innerHTML]="'label_no_history_in_instance'|bkTranslate:this"></p>
                        <p class="list-no-items__sub-label"
                           [innerHTML]="'label_no_history_in_instance_comments'|bkTranslate:this"></p>
                    </div>


                    <div class="row" *ngIf="currentHistoricInstance">
                        <div class="col-sm-12">
                            <div class="col-sm-6">

                                <h3 class="font-color-blocko"><strong>{{'label_blocko'|bkTranslate:this}}</strong>
                                </h3>

                                <div>
                                    <strong class="font-color-blocko">{{'label_blocko'|bkTranslate:this}}</strong>
                                    {{'label_program'|bkTranslate:this}}:
                                    <span class="font-grey-mint bold"><a
                                        (click)="onBlockoProgramClick(currentHistoricInstance.b_program_id)">{{currentHistoricInstance.b_program_name}}</a></span>
                                </div>
                                <div>
                                    <strong class="font-color-blocko">{{'label_blocko'|bkTranslate:this}}</strong>
                                    {{'label_description'|bkTranslate:this}}:
                                    <span
                                        class="font-grey-mint bold">{{currentHistoricInstance.b_program_description}}</span>
                                </div>
                                <br>
                                <div>
                                    <strong class="font-color-blocko">{{'label_blocko'|bkTranslate:this}}</strong>
                                    {{'label_version'|bkTranslate:this}}:
                                    <span class="font-grey-mint bold">
                                        <a (click)="onBlockoProgramVersionClick(currentHistoricInstance.b_program_id, currentHistoricInstance.b_program_version_id)">{{currentHistoricInstance.b_program_version_name}}</a>
                                    </span>
                                </div>
                                <div>
                                    <strong class="font-color-blocko">{{'label_blocko'|bkTranslate:this}}</strong>
                                    {{'label_description'|bkTranslate:this}}:
                                    <span class="font-grey-mint bold">{{currentHistoricInstance.b_program_version_description}}</span>
                                </div>

                            </div>
                            <div class="col-sm-6">

                                <h3 class="font-color-cloud"><strong> {{'label_cloud'|bkTranslate:this}}</strong>
                                </h3>

                                <div>
                                    {{'label_created'|bkTranslate:this}}:
                                    <span class="font-grey-mint bold">{{currentHistoricInstance.date_of_created|bkUnixTimeToDate}}</span>
                                </div>
                                <div>
                                    {{'label_running_from'|bkTranslate:this}}:
                                    <span class="font-grey-mint bold">{{currentHistoricInstance.running_from|bkUnixTimeToDate}}</span>
                                </div>
                                <div>
                                    {{'label_running_to'|bkTranslate:this}}:
                                    <span class="font-grey-mint bold">{{currentHistoricInstance.running_to|bkUnixTimeToDate}}</span>
                                </div>
                                <div>
                                    {{'label_running_status'|bkTranslate:this}}:
                                    <span class="font-grey-mint bold">{{currentHistoricInstance.status|bkTranslateTable:this:'instance_status'}}</span>
                                </div>

                            </div>
                        </div>
                    </div>
                    <br>
                    <br>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="col-6" *ngIf="currentHistoricInstance">
                                <div class="col-sm-6">
                                    <h3 class="font-color-hardware">
                                        <strong>{{'label_hardware'|bkTranslate:this}}</strong></h3>
                                    <div *ngFor="let hardware of currentHistoricInstance.hardware_group"
                                         style="margin-bottom: 20px;background: #EEE;padding: 10px;border: 1px solid #1BA39C !important;">
                                        <div>
                                            <a (click)="onHardwareClick(hardware.main_board_pair.board_id)"
                                               style="margin-bottom: 3px;display: block !important;"
                                               class="font-color-hardware">
                                                <strong><span style="font-size:1.2em;">{{hardware.main_board_pair.board_name?(hardware.main_board_pair.board_name+' '):('')}}</span></strong>
                                                <span
                                                    style="font-size:0.9em;">({{hardware.main_board_pair.board_id}})</span>
                                            </a>
                                        </div>
                                        <template
                                            [ngIf]="hardware.main_board_pair.board_description && hardware.main_board_pair.board_description.length">
                                            <div style="font-size:0.9em; color:#888;">
                                                {{hardware.main_board_pair.board_description}}
                                            </div>
                                        </template>
                                        <div><strong
                                            class="font-color-hardware">{{'label_hardware'|bkTranslate:this}}</strong>
                                            {{'label_device_type'|bkTranslate:this}}:
                                            <strong><a
                                                class="font-grey-mint"
                                                (click)="onBoardTypeClick(hardware.main_board_pair.type_of_board_id)">{{hardware.main_board_pair.type_of_board_name}}</a></strong>
                                        </div>
                                        <br>
                                        <div>
                                            <strong class="font-color-code">{{'label_code'|bkTranslate:this}}</strong>
                                            {{'label_program'|bkTranslate:this}}:
                                            <strong><a
                                                (click)="onCProgramClick(hardware.main_board_pair.c_program_id)">{{hardware.main_board_pair.c_program_name}}</a></strong>
                                            <template
                                                [ngIf]="hardware.main_board_pair.c_program_description && hardware.main_board_pair.c_program_description.length">
                                                <span>&nbsp;-&nbsp;{{hardware.main_board_pair.c_program_description}}</span>
                                            </template>
                                        </div>
                                        <div>
                                            <strong class="font-color-code">{{'label_code'|bkTranslate:this}}</strong>
                                            {{'label_version'|bkTranslate:this}}:
                                            <strong><a
                                                (click)="onCProgramVersionClick(hardware.main_board_pair.c_program_id, hardware.main_board_pair.c_program_version_id)">{{hardware.main_board_pair.c_program_version_name}}</a></strong>
                                            <template
                                                [ngIf]="hardware.main_board_pair.c_program_version_description && hardware.main_board_pair.c_program_version_description.length">
                                                <span>&nbsp;-&nbsp;{{hardware.main_board_pair.c_program_version_description}}</span>
                                            </template>
                                        </div>
                                        <div style="margin-left: 10px; margin-top: 10px;"
                                             *ngFor="let slave of hardware.device_board_pairs">
                                            <div>
                                                <a (click)="onHardwareClick(slave.board_id)" class="font-color-hardware"
                                                   style="margin-bottom: 3px;display: block !important;margin-top: 20px;">
                                                    <strong><span style="font-size:1.2em;">{{slave.board_name?(slave.board_name+' '):('')}}</span></strong>
                                                    <span style="font-size:0.9em;">({{slave.board_id}})</span>
                                                </a>
                                            </div>
                                            <div><strong class="font-color-hardware">{{'label_hardware_caps'|bkTranslate:this}}</strong>
                                                {{'table_hardware_type'|bkTranslate:this}}:
                                                <strong><a (click)="onBoardTypeClick(slave.type_of_board_id)">{{slave.type_of_board_name}}</a></strong>
                                            </div>
                                            <br>
                                            <div>
                                                <strong
                                                    class="font-color-code">{{'label_code'|bkTranslate:this}}</strong>
                                                {{'table_program'|bkTranslate:this}}:
                                                <strong><a (click)="onCProgramClick(slave.c_program_id)">{{slave.c_program_name}}</a></strong>
                                                <template
                                                    [ngIf]="slave.c_program_description && slave.c_program_description.length">
                                                    <span>&nbsp;-&nbsp;{{slave.c_program_description}}</span>
                                                </template>
                                            </div>
                                            <div>
                                                <strong
                                                    class="font-color-code">{{'label_code'|bkTranslate:this}}</strong>
                                                {{'label_version'|bkTranslate:this}}:
                                                <strong><a
                                                    (click)="onCProgramVersionClick(slave.c_program_id, slave.c_program_version_id)">{{slave.c_program_version_name}}</a></strong>
                                                <template
                                                    [ngIf]="slave.c_program_version_description && slave.c_program_version_description.length">
                                                    <span>&nbsp;-&nbsp;{{slave.c_program_version_description}}</span>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                    <div
                                        *ngIf="currentHistoricInstance.hardware_group && !currentHistoricInstance.hardware_group.length"
                                        class="list-no-items">
                                        <p class="list-no-items__main-label"
                                           [innerHTML]="'label_hardware_no_hardware_in_instance'|bkTranslate:this"></p>
                                        <p class="list-no-items__sub-label"
                                           [innerHTML]="'label_hardware_no_hardware_in_instancecomments'|bkTranslate:this"></p>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <h3 class="font-color-grid"><strong>{{'label_grid'|bkTranslate:this}}</strong>
                                    </h3>
                                    <div *ngFor="let grid of currentHistoricInstance.m_project_snapshot"
                                         style="margin-bottom: 20px;background: #EEE;padding: 10px;border: 1px solid #8E44AD !important;">
                                        <div>
                                            <strong class="font-color-grid">{{'label_grid'|bkTranslate:this}}</strong>{{'table_project'|bkTranslate:this}}:
                                            <a (click)="onGridProjectClick(grid.m_project_id)"><strong><span
                                                style="font-size:1.2em;">{{grid.m_project_name}}</span></strong></a>
                                        </div>
                                        <template
                                            [ngIf]="grid.m_project_description && grid.m_project_description.length">
                                            <div style="font-size:0.9em; color:#888;">
                                                {{grid.m_project_description}}
                                            </div>
                                        </template>
                                        <hr style="margin: 0;border-bottom: 1px solid #DDD;margin-top: 10px;">
                                        <div style="margin-left: 10px; margin-top: 10px;"
                                             *ngFor="let gridProgram of grid.m_program_snapshots">
                                            <div>
                                                <strong
                                                    class="font-color-grid">{{'label_grid'|bkTranslate:this}} </strong>{{'table_program'|bkTranslate:this}}:
                                                <a (click)="onGridProgramClick(grid.m_project_id,gridProgram.m_program_id)">
                                                    <strong><span style="font-size:1.0em;">{{gridProgram.m_program_name}}</span></strong>
                                                </a>
                                            </div>
                                            <template
                                                [ngIf]="gridProgram.m_program_description && gridProgram.m_program_description.length">
                                                <div style="font-size:0.9em; color:#888;">
                                                    {{gridProgram.m_program_description}}
                                                </div>
                                            </template>

                                            <div>
                                                <strong
                                                    class="font-color-grid">{{'label_grid'|bkTranslate:this}} </strong>{{'label_version'|bkTranslate:this}}:
                                                <strong><a
                                                    (click)="onGridProgramVersionClick(grid.m_project_id, gridProgram.m_program_id, gridProgram.version_object_id)">{{gridProgram.version_object_name}}</a></strong>
                                                <template
                                                    [ngIf]="gridProgram.version_object_description && gridProgram.version_object_description.length">
                                                    <span>&nbsp;-&nbsp;{{gridProgram.version_object_description}}</span>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                    <div
                                        *ngIf="currentHistoricInstance.m_project_snapshot && !currentHistoricInstance.m_project_snapshot.length"
                                        class="list-no-items">
                                        <p class="list-no-items__main-label"
                                           [innerHTML]="'label_grid_no_grid_in_instance'|bkTranslate:this"></p>
                                        <p class="list-no-items__sub-label"
                                           [innerHTML]="'label_grid_no_grid_in_instance_comments'|bkTranslate:this"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div *ngIf="instanceTab == 'update'">

                    <div *ngIf="instance && instance.actual_instance && instance.actual_instance.procedure_short_details.length" class="portlet portlet light bordered">

                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th class="col col-lg-1">{{'table_id'|bkTranslate:this}}</th>
                                <th class="col col-lg-2">{{'table_started'|bkTranslate:this}}</th>
                                <th class="col col-lg-2">{{'table_planed'|bkTranslate:this}}</th>
                                <th class="col col-lg-2">{{'table_finished'|bkTranslate:this}}</th>
                                <th class="col col-lg-2">{{'table_type'|bkTranslate:this}}</th>
                                <th class="col col-lg-1 text-center">{{'table_progress'|bkTranslate:this}}</th>
                                <th class="col col-lg-2 text-center">{{'table_state'|bkTranslate:this}}</th>
                            </tr>
                            </thead>

                            <tbody>

                            <tr *ngFor="let procedure of instance.actual_instance.procedure_short_details">

                                <td><a (click)="onProcedureClick(procedure)">{{procedure.id.substr(0,13)}}</a></td>
                                <td>{{procedure.date_of_create|bkUnixTimeToDate}}</td>
                                <td>{{procedure.date_of_planing|bkUnixTimeToDate}}</td>
                                <td>
                                    <span *ngIf="!procedure.date_of_finish" class="font-yellow-casablanca">{{'label_time_missing_in_json'|bkTranslate:this}}</span>
                                    <span *ngIf="procedure.date_of_finish">{{procedure.date_of_finish|bkUnixTimeToDate}}</span>
                                </td>
                                <td>{{procedure.type_of_update|bkTranslateTable:this:'type_of_update'}}</td>
                                <td class="text-center">
                                    <span *ngIf="procedure.procedure_size_all > 0" class="bold">{{procedure.procedure_size_complete}}/{{procedure.procedure_size_all}}</span>
                                    <span *ngIf="!procedure.procedure_size_all ||procedure_size_all == 0 " class="bold">-/-</span>
                                </td>
                                <td class="text-center">
                                    <span [innerHTML]="procedure.state|bkTranslateTable:this:'update_status'"></span>
                                </td>

                                <!--div>
                                            <div *ngIf="procedure.updates.length>0">
                                                <div class="table-scrollable" *ngIf="procedure.updates.length">
                                                    <table class="table table-hover">
                                                        <thead>
                                                        <tr>
                                                            <th><strong
                                                                class="font-color-hardware">{{'label_hardware'|bkTranslate:this}}</strong>{{'table_name'|bkTranslate:this}}
                                                            </th>
                                                            <th><strong
                                                                class="font-color-hardware">{{'label_hardware'|bkTranslate:this}}</strong>{{'table_id'|bkTranslate:this}}
                                                            </th>
                                                            <th><strong
                                                                class="font-color-hardware">{{'label_hardware'|bkTranslate:this}}</strong>{{'table_hardware_type'|bkTranslate:this}}
                                                            </th>
                                                            <th>{{'label_finished'|bkTranslate:this}}</th>
                                                            <th>{{'label_firmware_type'|bkTranslate:this}}</th>
                                                            <th><strong
                                                                class="font-color-code">{{'label_code'|bkTranslate:this}}</strong>{{'label_program'|bkTranslate:this}}
                                                            </th>
                                                            <th><strong
                                                                class="font-color-code">{{'label_code'|bkTranslate:this}}</strong>{{'label_version'|bkTranslate:this}}
                                                            </th>
                                                            <th>{{'label_status'|bkTranslate:this}}</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>

                                                        <tr *ngFor="let update of procedure.updates">

                                                            <td class="vert-align font-grey-mint"><a
                                                                (click)="onHardwareClick(update.board_detail.board_id)">{{update.board_detail.name}}</a>
                                                            </td>
                                                            <td class="vert-align font-grey-mint"><a
                                                                (click)="onHardwareClick(update.board_detail.board_id)">{{update.board_detail.board_id}}</a>
                                                            </td>
                                                            <td class="vert-align font-grey-mint"><a style="white-space:nowrap"
                                                                                                     (click)="onBoardTypeClick(update.board_detail.type_of_board_id)">{{update.board_detail.type_of_board_name}}</a>
                                                            </td>


                                                            <td *ngIf="update.date_of_finish" class="vert-align">
                                                                {{update.date_of_finish|bkUnixTimeToDate}}
                                                            </td>
                                                            <td *ngIf="!update.date_of_finish"
                                                                class="vert-align font-yellow-casablanca">
                                                                {{'label_unknown_date'|bkTranslate:this}}
                                                            </td>


                                                            <td class="vert-align font-grey-mint">
                                                                <span *ngIf="update.firmware_type == 'FIRMWARE'"
                                                                      class="bold font-color-grid">{{'label_frimware'|bkTranslate:this}}</span>
                                                                <span *ngIf="update.firmware_type == 'BACKUP'"
                                                                      class="bold font-color-grid-dark">{{'label_backup'|bkTranslate:this}}</span>
                                                                <span *ngIf="update.firmware_type == 'BOOTLOADER'"
                                                                      class="bold font-blue">{{'label_bootloader'|bkTranslate:this}}</span>
                                                            </td>

                                                            <td class="vert-align font-grey-mint"><a
                                                                (click)="onCProgramClick(update.c_program_detail.c_program_id)">{{update.c_program_detail.c_program_program_name}}</a>
                                                            </td>
                                                            <td class="vert-align font-grey-mint"><a
                                                                (click)="onCProgramClick(update.c_program_detail.c_program_id)">{{update.c_program_detail.c_program_version_id}}</a>
                                                            </td>

                                                            <td class="vert-align">
                                                                <span
                                                                    *ngIf="update.state == ('complete') || ('canceled') || ('overwritten')"
                                                                    class="bold font-green-jungle">{{update.state|bkTranslateTable:this:'update_state'}}</span>
                                                                <span
                                                                    *ngIf="update.state == ('not_start_yet') || ('in_progress') || ('not_updated') || ('waiting_for_device')"
                                                                    class="bold font-yellow-casablanca">{{update.state|bkTranslateTable:this:'update_state'}} </span>
                                                                <span
                                                                    *ngIf="update.state == ('homer_server_is_offline') || ('instance_inaccessible') || ('critical_error') || ('bin_file_not_found')"
                                                                    class="bold font-red-flamingo">{{update.state|bkTranslateTable:this:'update_state'}}</span>
                                                            </td>
                                                        </tr>

                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <div *ngIf="procedure.updates.length == 0" class="list-no-items">
                                                <p class="list-no-items__main-label">{{'label_no_updates_title'|bkTranslate:this}}</p>
                                                <p class="list-no-items__sub-label">{{'label_no_update_text'|bkTranslate:this}}</p>
                                            </div>
                                        </div-->
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3 *ngIf="!instance" class="text-center">{{'loading'|bkTranslate:this}}</h3>
                    <div
                        *ngIf="instance && (!instance.actual_instance || !instance.actual_instance.procedure_short_details.length)"
                        class="list-no-items">
                        <p class="list-no-items__main-label"
                           [innerHTML]="'label_no_running_update_on_instance'|bkTranslate:this"></p>
                        <p class="list-no-items__sub-label"
                           [innerHTML]="'label_no_running_update_on_instance_comments'|bkTranslate:this"></p>
                    </div>

                </div>

                <div *ngIf="instanceTab == 'view' ">

                    <div *ngIf="instance && instance.online_state == 'online'">
                        <bk-blocko-view [disableExecution]="true" [canConfig]="false" [readonly]="true"
                                        [simpleMode]="false" [showBlockNames]="true"></bk-blocko-view>
                        <div style="margin-top: 30px">
                            <bk-console-log maxHeight="400px"></bk-console-log>
                        </div>
                    </div>
                    <div *ngIf="!instance || instance.online_state != 'online'" class="list-no-items">
                        <p class="list-no-items__main-label"
                           [innerHTML]="'label_instance_info_is_offline'|bkTranslate:this"></p>
                        <p class="list-no-items__sub-label"
                           [innerHTML]="'label_instance_info_is_offline_comments'|bkTranslate:this"></p>
                    </div>

                </div>

                <div *ngIf="instanceTab == 'logs'">
                </div>

                <div *ngIf="instanceTab == 'debug'">
                </div>


            </div>
        </div>
    </div>

</bk-layout-main>
